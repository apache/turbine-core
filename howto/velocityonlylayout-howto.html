<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html><head><title>Turbine - VelocityOnlyLayout</title><style type="text/css" media="all">
          @import url("../style/maven-base.css");
          
          @import url("../style/maven-theme.css");</style><link rel="stylesheet" href="../style/print.css" type="text/css" media="print"></link><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"></meta><meta name="author" content="Quinton McCombs"></meta><meta name="email" content="quintonm@bellsouth.net"></meta><meta name="author" content="Scott Eade"></meta><meta name="email" content="seade@backstagetech.com.au"></meta></head><body class="composite"><div id="banner"><a href="http://turbine.apache.org/" id="organizationLogo"><img alt="Apache Software Foundation" src="../images/turbine-project.png"></img></a><a href="http://turbine.apache.org/turbine/turbine-2.3.3/index.html" id="projectLogo"><img alt="turbine-2" src="../images/logo.gif"></img></a><div class="clear"><hr></hr></div></div><div id="breadcrumbs"><div class="xleft">Last published: 21 November 2008
                <span class="separator">|</span> Doc for  2.3.3
                </div><div class="xright">
        
        <a href="http://turbine.apache.org/">Turbine Home</a>
      
        
          
            <span class="separator">|</span>
          
        
        <a href="http://turbine.apache.org/fulcrum/">Fulcrum</a>
      
        
          
            <span class="separator">|</span>
          
        
        <a href="http://turbine.apache.org/meta/">META</a>
      </div><div class="clear"><hr></hr></div></div><div id="leftColumn"><div id="navcolumn"><div id="menuGeneral_Information"><h5>General Information</h5><ul><li class="none"><a href="../index.html">Overview</a></li><li class="none"><a href="../features.html">Features</a></li><li class="none"><a href="../fsd.html">Specification</a></li><li class="none"><a href="../getting-started.html">Getting Started</a></li></ul></div><div id="menuDocumentation"><h5>Documentation</h5><ul><li class="none"><a href="../changes-report.html">Changes</a></li><li class="none"><a href="../turbine-schema.html">Core DB Schema</a></li><li class="collapsed"><a href="../services/index.html">Services</a></li><li class="expanded"><a href="../howto/index.html">Howtos</a><ul><li class="none"><a href="../howto/action-event-howto.html">Action Events Howto</a></li><li class="none"><a href="../howto/configuration-howto.html">Configuration Howto</a></li><li class="none"><a href="../howto/extend-user-howto.html">Extend User Howto</a></li><li class="none"><a href="../howto/hibernate-howto.html">Hibernate OM Howto</a></li><li class="none"><a href="../howto/intake-howto.html">Intake Howto</a></li><li class="none"><a href="../howto/jboss-howto.html">JBoss Howto</a></li><li class="none"><a href="../howto/jsp-howto.html">JSP Howto</a></li><li class="none"><a href="../howto/migrate-from-2_1-howto.html">Migrating 2.1 to 2.2</a></li><li class="none"><a href="../howto/migrate-from-2_2-howto.html">Migrating 2.2 to 2.3</a></li><li class="none"><a href="../howto/pullmodel-howto.html">Pull Model Howto</a></li><li class="none"><a href="../howto/python-howto.html">Python Howto</a></li><li class="none"><a href="../howto/security-howto.html">Security Howto</a></li><li class="none"><a href="../howto/services-howto.html">Services Howto</a></li><li class="none"><a href="../howto/sql-howto.html">How to build the SQL files</a></li><li class="none"><a href="../howto/url-rewriting-howto.html">URL rewriting Howto</a></li><li class="none"><a href="../howto/context-howto.html">Velocity Context Howto</a></li><li class="none"><a href="../howto/velocity-site-howto.html">Velocity Site Howto</a></li><li class="none"><strong><a href="../howto/velocityonlylayout-howto.html">VelocityOnlyLayout Howto</a></strong></li><li class="none"><a href="http://wiki.apache.org/turbine/Turbine2" class="externalLink" title="External Link">Wiki Howtos</a></li></ul></li><li class="none"><a href="../apidocs/index.html">JavaDocs</a></li></ul></div><div id="menuDevelopment"><h5>Development</h5><ul><li class="none"><a href="../proposals.html">Proposals</a></li><li class="none"><a href="../how-to-help.html">How To Help</a></li><li class="none"><a href="../todo.html">Todo</a></li></ul></div><div id="menuProject_Documentation"><h5>Project Documentation</h5><ul><li class="none"><a href="../index.html">About</a></li><li class="collapsed"><a href="../project-info.html">Project Info</a></li><li class="collapsed"><a href="../maven-reports.html">Project Reports</a></li><li class="none"><a href="../development-process.html">Development Process</a></li></ul></div><div id="legend"><h5>Legend</h5><ul><li class="externalLink">External Link</li><li class="newWindow">Opens in a new window</li></ul></div><a href="http://maven.apache.org/" title="Built by Maven" id="poweredBy"><img alt="Built by Maven" src="../images/logos/mavenlogo_builtby_w.png"></img></a></div></div><div id="bodyColumn"><div class="contentBox"><div class="section"><a name="Introduction"></a><h2>Introduction</h2>
<p>
    <strong>The VelocityECSLayout was deprecated in Turbine 2.3 (and removed in
    2.3.3).</strong> This document is intended to help you convert your
    application to use the VelocityOnlyLayout.
</p>
<p>
    The VelocityOnlyLayout does not use ECS to generate the HTML page for
    you. This also means that the current $page pull tool will not work with
    the VelocityOnlyLayout. You will be responsible for constructing the HTML,
    HEAD, BODY, etc. tags using Velocity.
</p>
<p>
    Although this seems like a lot of trouble, it really isn't. All that you
    really need to do is modify your layout templates. You will still use the
    $page pull tool just like before. Your layout templates will also use the
    $page pull tool to extract the data needed to build the HEAD and BODY
    tags.
</p>
</div><div class="section"><a name="Changes_to_make_in_TR_props"></a><h2>Changes to make in TR.props</h2>
<p>
    Changes the definition of the $page pull tool:
</p>

    <div class="source"><pre>

tool.request.page = org.apache.turbine.util.template.HtmlPageAttributes

</pre></div>
  
<p>
	Change the default layout
</p>

    <div class="source"><pre>

services.VelocityService.default.layout = VelocityOnlyLayout

</pre></div>
  

</div><div class="section"><a name="Changes_to_your_code"></a><h2>Changes to your code</h2>
<p>
  <ul>
  	<li>$page.addAttribute(attribute,value) has been replaced with
  	    $page.addBodyAttribute(attribute,value)</li>
  	<li>$page.setScript(url) has been replaced with
  	    $page.addScript(url)</li>
  	<li>$page.setStyleSheet(url) has been replaced with
  	    $page.addStyleSheet(url)</li>
  	<li>$page.setStyle(styleText) has been replaced with
  	    $page.addStyle(styleText)</li>
  	<li>$page.setStyleSheet(url,media) has been replaced with
  	    $page.addStyleSheet(url,media,title,type)</li>
  </ul>
</p>
<p>
    <em>Use of any of the deprecated methods will generate a log message
    at the info level.</em>
</p>
<p>
    Add the line
</p>

    <div class="source"><pre>

$page.DefaultDoctype

</pre></div>
  
<p>
    to your layout templates to pick up the default doctype definition from
    TurbineResources.properties thus:
</p>

    <div class="source"><pre>

# Set the components of the default Doctype for use in html documents.
#
# Defaults: There are no defaults - if default.html.doctype.root.element is not
#           set then no default doctype will be available.

default.html.doctype.root.element=HTML
default.html.doctype.identifier=-//W3C//DTD HTML 4.01 Transitional//EN
default.html.doctype.url=http://www.w3.org/TR/1999/REC-html401-19991224/loose.dtd

</pre></div>
  
<p>
    Add the line
</p>

    <div class="source"><pre>

services.VelocityService.velocimacro.library = macros/TurbineMacros.vm

</pre></div>
  
<p>
    to your TurbineResources.properties and it will pick up the
    TurbineMacros.vm in your Turbine jar. An example of how to use
    these macros follows.
</p>
<p>
    Here is a sample layout template that you can use:
</p>

    <div class="source"><pre>

    ## Set defaults for all pages using this layout.  Anything set here can
    ## be overridden in the screen template.
    $page.setTitle("My default page title");
    $page.setHttpEquiv("Content-Style-Type","text/css")
    $page.addStyleSheet($content.getURI("myStyleSheet.css"))
    $page.addScript($content.getURI("globalJavascriptCode.js"))
    ## build the HTML, HEAD, and BODY tags dynamically

    $page.DefaultDoctype
    &lt;html&gt;
      #TurbineHtmlHead()
      &lt;body #TurbineHtmlBodyAttributes() &gt;
      $navigation.setTemplate("default_header.vm")
      $screen_placeholder
      $navigation.setTemplate("default_footer.vm")

      &lt;/body&gt;
    &lt;/html&gt;

</pre></div>
  
<p>
    This produces the same code as the following sample layout
    template that you can use:
</p>
	
    <div class="source"><pre>

    ## Set defaults for all pages using this layout.  Anything set here can
    ## be overridden in the screen template.
    $page.setTitle("My default page title");
    $page.setHttpEquiv("Content-Style-Type","text/css")
    $page.addStyleSheet($content.getURI("myStyleSheet.css"))
    $page.addScript($content.getURI("globalJavascriptCode.js"))
    ## build the HTML, HEAD, and BODY tags dynamically

    $page.DefaultDoctype
    &lt;html&gt;
      &lt;head&gt;
        #if($page.Title != "")
        &lt;title&gt;$page.Title&lt;/title&gt;
        #end
        #foreach($metaTag in $page.MetaTags.keySet())
        &lt;meta name="$metaTag" content="$page.MetaTags.get($metaTag)"&gt;
        #end
        #foreach($httpEquiv in $page.HttpEquivs.keySet())
        &lt;meta http-equiv="$httpEquiv" content="$page.HttpEquivs.get($httpEquiv)"&gt;
        #end
        #foreach( $linkTag in $page.Links )
        &lt;link rel="$linkTag.Relation" href="$linkTag.Url"
          #if($!linkTag.Type)  type="$linkTag.Type"   #end
          #if($!linkTag.Media) media="$linkTag.Media" #end
          #if($!linkTag.Title) title="$linkTag.Title" #end
        &gt;
        #end
        #if ($page.Styles.size() &gt; 0)
          &lt;style type="text/css"&gt;
          #foreach( $style in $page.Styles )
            $!style
          #end
          &lt;/style&gt;
        #end
        #foreach($script in $page.Scripts)
          &lt;script type="text/javascript" src="$script" language="JavaScript"&gt;&lt;/script&gt;
        #end
      &lt;/head&gt;

      ## Construct the body tag.  Iterate through the body attributes to build the opening tag
      &lt;body
        #foreach($attributeName in $page.BodyAttributes.keySet())
          $attributeName = "$page.BodyAttributes.get($attributeName)"
        #end
      &gt;

      $navigation.setTemplate("default_header.vm")
      $screen_placeholder
      $navigation.setTemplate("default_footer.vm")

      &lt;/body&gt;
    &lt;/html&gt;

</pre></div>
  
</div><div class="section"><a name="Writing_Directly_To_ServletOutputStream"></a><h2>Writing Directly To ServletOutputStream</h2>
<p>
    See
	<a href="http://wiki.apache.org/turbine/Turbine2/VelocityOnlyLayout" class="externalLink" title="External Link">
	VelocityOnlyLayout</a> on the Apache wiki for some information concerning
	writing directly to ServletOutputStream.
</p>
</div><div class="section"><a name="Updates_to_this_document"></a><h2>Updates to this document</h2>
<p>
    This document is by no means complete or totally accurate. We welcome
    suggestions as to how it might be improved, particularly if you have
    just completed updating an application by following this howto.
</p>
</div></div></div><div class="clear"><hr></hr></div><div id="footer"><div class="xright">© 2000-2008, Apache Software Foundation</div><div class="clear"><hr></hr></div></div></body></html>