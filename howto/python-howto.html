<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Apache Maven Doxia Site Renderer 1.4 at 21 December 2015 -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Apache Turbine - 
  Python Howto</title>
    <style type="text/css" media="all">
      @import url("../css/maven-base.css");
      @import url("../css/maven-theme.css");
      @import url("../css/site.css");
    </style>
    <link rel="stylesheet" href="../css/print.css" type="text/css" media="print" />
    <meta name="Date-Revision-yyyymmdd" content="20151221" />
    <meta http-equiv="Content-Language" content="en" />
        
        </head>
  <body class="composite">
    <div id="banner">
                                      <a href="../../../" id="bannerLeft" title="Apache Turbine">
                                                <img src="../images/turbine-project.png" alt="Apache Turbine" />
                </a>
                          <div id="bannerRight">
                                                <img src="../images/logo.gif" alt="Apache Turbine" />
                </div>
            <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
            
                    
                <div class="xleft">
        <span id="publishDate">Last Published: 21 December 2015</span>
                  &nbsp;| <span id="projectVersion">Version: 4.0-M2</span>
                      </div>
            <div class="xright">                    <a href="http://www.apache.org" class="externalLink" title="Apache">Apache</a>
            |
                        <a href="../../../" title="Turbine">Turbine</a>
            |
                        <a href="../../../fulcrum/" title="Fulcrum">Fulcrum</a>
              
                    
      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
             
                    
                                <h5>General Information</h5>
                  <ul>
                  <li class="none">
                          <a href="../index.html" title="Overview">Overview</a>
            </li>
                  <li class="none">
                          <a href="../features.html" title="Features">Features</a>
            </li>
                  <li class="none">
                          <a href="../fsd.html" title="Specification">Specification</a>
            </li>
                  <li class="none">
                          <a href="../getting-started.html" title="Getting Started">Getting Started</a>
            </li>
                  <li class="none">
                          <a href="../how-to-build.html" title="Howto Build Turbine">Howto Build Turbine</a>
            </li>
                  <li class="none">
                          <a href="../changes-report.html" title="Changes">Changes</a>
            </li>
          </ul>
                       <h5>Documentation</h5>
                  <ul>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <li class="collapsed">
                          <a href="../services/index.html" title="Services">Services</a>
                  </li>
                                                                                                                                                                                                                                                                                                                                                                                                <li class="expanded">
                          <a href="../howto/index.html" title="Howtos">Howtos</a>
                    <ul>
                      <li class="none">
                          <a href="../howto/action-event-howto.html" title="Action Events Howto">Action Events Howto</a>
            </li>
                      <li class="none">
                          <a href="../howto/annotations.html" title="Annotations Howto">Annotations Howto</a>
            </li>
                      <li class="none">
                          <a href="../howto/configuration-howto.html" title="Configuration Howto">Configuration Howto</a>
            </li>
                      <li class="none">
                          <a href="../howto/extend-user-howto.html" title="Extend User Howto">Extend User Howto</a>
            </li>
                      <li class="none">
                          <a href="../howto/hibernate-howto.html" title="Hibernate OM Howto">Hibernate OM Howto</a>
            </li>
                      <li class="none">
                          <a href="../howto/intake-howto.html" title="Intake Howto">Intake Howto</a>
            </li>
                      <li class="none">
                          <a href="../howto/jsp-howto.html" title="JSP Howto">JSP Howto</a>
            </li>
                      <li class="none">
                          <a href="../howto/migrate-from-2_1-howto.html" title="Migrating from 2.1 to 2.2">Migrating from 2.1 to 2.2</a>
            </li>
                      <li class="none">
                          <a href="../howto/migrate-from-2_2-howto.html" title="Migrating from 2.2 to 2.3">Migrating from 2.2 to 2.3</a>
            </li>
                      <li class="none">
                          <a href="../howto/migrate-from-2_3-howto.html" title="Migrating from 2.3 to 4.0">Migrating from 2.3 to 4.0</a>
            </li>
                      <li class="none">
                          <a href="../howto/pullmodel-howto.html" title="Pull Model Howto">Pull Model Howto</a>
            </li>
                      <li class="none">
            <strong>Python Howto</strong>
          </li>
                      <li class="none">
                          <a href="../howto/security-howto.html" title="Security Howto">Security Howto</a>
            </li>
                      <li class="none">
                          <a href="../howto/services-howto.html" title="Services Howto">Services Howto</a>
            </li>
                      <li class="none">
                          <a href="../howto/url-rewriting-howto.html" title="URL rewriting Howto">URL rewriting Howto</a>
            </li>
                      <li class="none">
                          <a href="../howto/context-howto.html" title="Velocity Context Howto">Velocity Context Howto</a>
            </li>
                      <li class="none">
                          <a href="../howto/velocity-site-howto.html" title="Velocity Site Howto">Velocity Site Howto</a>
            </li>
                      <li class="none">
                          <a href="../howto/velocityonlylayout-howto.html" title="VelocityOnlyLayout Howto">VelocityOnlyLayout Howto</a>
            </li>
              </ul>
        </li>
                  <li class="none">
                          <a href="http://wiki.apache.org/turbine/FrontPage" class="externalLink" title="Wiki">Wiki</a>
            </li>
                  <li class="none">
                          <a href="../apidocs/index.html" title="JavaDocs">JavaDocs</a>
            </li>
          </ul>
                       <h5>Development</h5>
                  <ul>
                  <li class="none">
                          <a href="../proposals.html" title="Proposals">Proposals</a>
            </li>
                  <li class="none">
                          <a href="../how-to-help.html" title="How To Help">How To Help</a>
            </li>
                  <li class="none">
                          <a href="../todo.html" title="Todo">Todo</a>
            </li>
          </ul>
                       <h5>Project Documentation</h5>
                  <ul>
                                                                                                                                                                                                                                                                                            <li class="collapsed">
                          <a href="../project-info.html" title="Project Information">Project Information</a>
                  </li>
                                                                                                                                                                                                                                                                                            <li class="collapsed">
                          <a href="../project-reports.html" title="Project Reports">Project Reports</a>
                  </li>
          </ul>
                       <h5>Apache</h5>
                  <ul>
                  <li class="none">
                          <a href="http://www.apache.org/" class="externalLink" title="Apache Website">Apache Website</a>
            </li>
                  <li class="none">
                          <a href="http://www.apache.org/licenses/" class="externalLink" title="License">License</a>
            </li>
                  <li class="none">
                          <a href="http://www.apache.org/foundation/how-it-works.html" class="externalLink" title="How the ASF works">How the ASF works</a>
            </li>
                  <li class="none">
                          <a href="http://www.apache.org/foundation/sponsorship.html" class="externalLink" title="Sponsorship">Sponsorship</a>
            </li>
                  <li class="none">
                          <a href="http://www.apache.org/foundation/thanks.html" class="externalLink" title="Thanks">Thanks</a>
            </li>
                  <li class="none">
                          <a href="http://www.apache.org/security/" class="externalLink" title="Security">Security</a>
            </li>
          </ul>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="../images/logos/maven-feather.png" />
      </a>
                   
                    
            </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        <!-- Licensed to the Apache Software Foundation (ASF) under one
 or more contributor license agreements.  See the NOTICE file
 distributed with this work for additional information
 regarding copyright ownership.  The ASF licenses this file
 to you under the Apache License, Version 2.0 (the
 "License"); you may not use this file except in compliance
 with the License.  You may obtain a copy of the License at

   http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing,
 software distributed under the License is distributed on an
 "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 KIND, either express or implied.  See the License for the
 specific language governing permissions and limitations
 under the License. -->

 
  <div class="section">
<h2>Turbine Python Support<a name="Turbine_Python_Support"></a></h2>
  
<p>
    Turbine has support for creating assemblers (see the <a href="fsd.html">
    specifications</a>) with Python, by making use of
    <a class="externalLink" href="http://www.jpython.org">JPython technology</a>.
  </p>
  
<p>
    The first question that comes to mind is why one would want do to something
    like this.  Here are some of the reasons you might want to do this:
  </p>
    
<ul>
        
<li>
            Python is an interpreted language which means that you do not have
            to recompile and copy a new jar each time you make changes.
        </li>

        
<li>
            Although Python is interpreted it is compiled to java bytecode.
            Performance is on par with native java code.
        </li>

        
<li>
            Python is very easy to learn.  This, together with the fact that
            you don't need to use a compiler, makes it possible for people with
            little java experience to create screens.
        </li>

        
<li>
            You can rapidly build a prototype using python, and later on find
            that it is not necessary to systematically move to java :-)
        </li>
    </ul>
  </div>

  
<div class="section">
<h2>Setting Up Python for Turbine<a name="Setting_Up_Python_for_Turbine"></a></h2>
    
<p>
        The first thing is to download JPython from www.jpython.org and copy
        the jpython.jar file into your turibe/lib directory.  Now you need to
        prepare and compile the jpython files like this:
</p>
<div class="source">
<pre>
build prepare-python
build jar
</pre></div>
        This will create a new turbine library that contains the Python code.
        You need to copy this new .jar file to your application's lib
        directory.
    
    
<p>
        Now we need to edit the TurbineResources.properties.  Add the following
        keys to your application's properties:
    </p>

<div class="source">
<pre>
services.AssemblerBrokerService.assembler.screen=
org.apache.turbine.util.assemblerbroker.python.PythonScreenFactory
services.AssemblerBrokerService.assembler.action=
org.apache.turbine.util.assemblerbroker.python.PythonActionFactory

services.AssemblerBrokerService.python.path=/path/to/python
</pre></div>
    
<p>
        The first two registers the Python Assembler Factories with the
        AssemblerBrokerService.  The last line tells the Python interpreter
        where to find all the .py files for your application.
    </p>
    
<p>
        In the root of your services.AssemblerBrokerService.python.path
        you need to add a file named config.py that looks like this:
    </p>


<div class="source">
<pre>
import java

from java.io import *
from java.util import *

sys.add_package(&quot;org.apache.turbine.modules.screens&quot;)
sys.add_package(&quot;org.apache.turbine.modules&quot;)
sys.add_package(&quot;org.apache.turbine.util.db&quot;)
sys.add_package(&quot;org.apache.turbine.util&quot;)
sys.add_package(&quot;org.apache.turbine.services.security.TurbineSecurity&quot;)
sys.add_package(&quot;org.webmacro.servlet&quot;)


from org.apache.turbine.modules.screens  import WebMacroSiteScreen
from org.apache.turbine.modules          import Action
from org.apache.turbine.util.db          import Criteria
from org.apache.turbine.util             import RunData
from org.webmacro.servlet                import WebContext
from org.apache.turbine.services.security   import TurbineSecurity
</pre></div>

      
<p>
        JPython sometimes gets a bit confused with the Servlet Engine
        classloader, which forces us to call sys.add_package for each java
        package that we wish to use in our Python code.  You also need to
        import all the classes that you wish to use explicitly.  You needn't
        add the classes here, but it avoid some duplicate declarations at the
        top of each screen/action.
    </p>
    </div>

    
<div class="section">
<h2>Using Python with Turbine<a name="Using_Python_with_Turbine"></a></h2>
    
<p>
        To create python screens we use exactly the same methodology than for
        normal java screens.  First you need a /screens subdirectory in your
        services.AssemblerBrokerService.python.path.  This is where your
        screen code will live.  Layouts goes in /layouts, actions in /actions
        and so forth (just remember to register the appropriate assembler
        factories).
    </p>
    
<p>
        I'm going to create a sample WebMacro screen.  First we need a .py file
        where this screen can live.  The .py file should have the same name as
        your .wm file and it must be all lower case.  Inside this file we
        create a new class with the same name as the file, but in this the
        first letter is uppercase (the rest is always lower case).  To override
        a method is fairly simple (just create a new method with the same
        name).
    </p>
    
<p>
        There is one problem however - Python does not support method
        overloading based on type signatures, so usually the simplest for is
        used, which is doBuildTemplate( RunData data ) for WebMacroSiteScreen
        in stead of doBuildTemplate( RunData data, WebContext context ).  You
        have two options to overcome this problem. (1) Create a new superclass
        that exposes a method under a different name or (2) just call
        getContext in your python code.  I usually just go for the second
        option because it is fairly straight forward anyway.
    </p>
    
<p>
        Now for the code.  Let's create a screen called Test.  First create a
        test.wm file (I assumer everybody knows how to do this).  Now create a
        test.py and place it in the python-path/screens directory.  It should
        look something like this:
    </p>


<div class="source">
<pre>
class Subjectslist(WebMacroSiteScreen):
   def doBuildTemplate (self,data):
        context = self.getContext(data)
        context.put (&quot;me&quot;,&quot;Leon&quot;)
        context.put (&quot;text&quot;,&quot;Python is cool&quot;);
</pre></div>

    
<p>
        For more information about the self parameter see the Python docs.  You
        can call any java code that you would normally be able to use (just
        remember to add it to conf.py) including database, services, etc. You
        can also freely use any of the Python built-in types and any Python
        module that was built on 100% pure Python.
    </p>
  </div>

 

      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
              Copyright &#169;                    2000-2015
                        <a href="http://www.apache.org/">The Apache Software Foundation</a>.
            All Rights Reserved.      
                    
                  </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>