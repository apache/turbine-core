<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html><head><title>Turbine - Python Howto</title><style type="text/css" media="all">
          @import url("../style/maven-base.css");
          
          @import url("../style/maven-theme.css");</style><link rel="stylesheet" href="../style/print.css" type="text/css" media="print"></link><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"></meta><meta name="author" content="Leon Messerschmidt"></meta><meta name="email" content="leon@opticode.co.za"></meta></head><body class="composite"><div id="banner"><a href="http://turbine.apache.org/" id="organizationLogo"><img alt="Apache Software Foundation" src="../images/turbine-project.png"></img></a><a href="http://turbine.apache.org/turbine/turbine-2.3.3/index.html" id="projectLogo"><img alt="turbine-2" src="../images/logo.gif"></img></a><div class="clear"><hr></hr></div></div><div id="breadcrumbs"><div class="xleft">Last published: 21 November 2008
                <span class="separator">|</span> Doc for  2.3.3
                </div><div class="xright">
        
        <a href="http://turbine.apache.org/">Turbine Home</a>
      
        
          
            <span class="separator">|</span>
          
        
        <a href="http://turbine.apache.org/fulcrum/">Fulcrum</a>
      
        
          
            <span class="separator">|</span>
          
        
        <a href="http://turbine.apache.org/meta/">META</a>
      </div><div class="clear"><hr></hr></div></div><div id="leftColumn"><div id="navcolumn"><div id="menuGeneral_Information"><h5>General Information</h5><ul><li class="none"><a href="../index.html">Overview</a></li><li class="none"><a href="../features.html">Features</a></li><li class="none"><a href="../fsd.html">Specification</a></li><li class="none"><a href="../getting-started.html">Getting Started</a></li></ul></div><div id="menuDocumentation"><h5>Documentation</h5><ul><li class="none"><a href="../changes-report.html">Changes</a></li><li class="none"><a href="../turbine-schema.html">Core DB Schema</a></li><li class="collapsed"><a href="../services/index.html">Services</a></li><li class="expanded"><a href="../howto/index.html">Howtos</a><ul><li class="none"><a href="../howto/action-event-howto.html">Action Events Howto</a></li><li class="none"><a href="../howto/configuration-howto.html">Configuration Howto</a></li><li class="none"><a href="../howto/extend-user-howto.html">Extend User Howto</a></li><li class="none"><a href="../howto/hibernate-howto.html">Hibernate OM Howto</a></li><li class="none"><a href="../howto/intake-howto.html">Intake Howto</a></li><li class="none"><a href="../howto/jboss-howto.html">JBoss Howto</a></li><li class="none"><a href="../howto/jsp-howto.html">JSP Howto</a></li><li class="none"><a href="../howto/migrate-from-2_1-howto.html">Migrating 2.1 to 2.2</a></li><li class="none"><a href="../howto/migrate-from-2_2-howto.html">Migrating 2.2 to 2.3</a></li><li class="none"><a href="../howto/pullmodel-howto.html">Pull Model Howto</a></li><li class="none"><strong><a href="../howto/python-howto.html">Python Howto</a></strong></li><li class="none"><a href="../howto/security-howto.html">Security Howto</a></li><li class="none"><a href="../howto/services-howto.html">Services Howto</a></li><li class="none"><a href="../howto/sql-howto.html">How to build the SQL files</a></li><li class="none"><a href="../howto/url-rewriting-howto.html">URL rewriting Howto</a></li><li class="none"><a href="../howto/context-howto.html">Velocity Context Howto</a></li><li class="none"><a href="../howto/velocity-site-howto.html">Velocity Site Howto</a></li><li class="none"><a href="../howto/velocityonlylayout-howto.html">VelocityOnlyLayout Howto</a></li><li class="none"><a href="http://wiki.apache.org/turbine/Turbine2" class="externalLink" title="External Link">Wiki Howtos</a></li></ul></li><li class="none"><a href="../apidocs/index.html">JavaDocs</a></li></ul></div><div id="menuDevelopment"><h5>Development</h5><ul><li class="none"><a href="../proposals.html">Proposals</a></li><li class="none"><a href="../how-to-help.html">How To Help</a></li><li class="none"><a href="../todo.html">Todo</a></li></ul></div><div id="menuProject_Documentation"><h5>Project Documentation</h5><ul><li class="none"><a href="../index.html">About</a></li><li class="collapsed"><a href="../project-info.html">Project Info</a></li><li class="collapsed"><a href="../maven-reports.html">Project Reports</a></li><li class="none"><a href="../development-process.html">Development Process</a></li></ul></div><div id="legend"><h5>Legend</h5><ul><li class="externalLink">External Link</li><li class="newWindow">Opens in a new window</li></ul></div><a href="http://maven.apache.org/" title="Built by Maven" id="poweredBy"><img alt="Built by Maven" src="../images/logos/mavenlogo_builtby_w.png"></img></a></div></div><div id="bodyColumn"><div class="contentBox"><div class="section"><a name="Turbine_Python_Support"></a><h2>Turbine Python Support</h2>
  <p>
    Turbine has support for creating assemblers (see the <a href="../fsd.html">
    specifications</a>) with Python, by making use of
    <a href="http://www.jpython.org" class="externalLink" title="External Link">JPython technology</a>.
  </p>
  <p>
    The first question that comes to mind is why one would want do to something
    like this.  Here are some of the reasons you might want to do this:
  </p>
    <ul>
        <li>
            Python is an interpreted language which means that you do not have
            to recompile and copy a new jar each time you make changes.
        </li>

        <li>
            Although Python is interpreted it is compiled to java bytecode.
            Performance is on par with native java code.
        </li>

        <li>
            Python is very easy to learn.  This, together with the fact that
            you don't need to use a compiler, makes it possible for people with
            little java experience to create screens.
        </li>

        <li>
            You can rapidly build a prototype using python, and later on find
            that it is not necessary to systematically move to java :-)
        </li>
    </ul>
  </div><div class="section"><a name="Setting_Up_Python_for_Turbine"></a><h2>Setting Up Python for Turbine</h2>
    <p>
        The first thing is to download JPython from www.jpython.org and copy
        the jpython.jar file into your turbine/lib directory.  Now you need to
        prepare and compile the jpython files like this:

    <div class="source"><pre>
build prepare-python
build jar
</pre></div>
  
        This will create a new turbine library that contains the Python code.
        You need to copy this new .jar file to your application's lib
        directory.
    </p>
    <p>
        Now we need to edit the TurbineResources.properties.  Add the following
        keys to your application's properties:
    </p>

    <div class="source"><pre>
services.AssemblerBrokerService.assembler.screen=
org.apache.turbine.util.assemblerbroker.python.PythonScreenFactory
services.AssemblerBrokerService.assembler.action=
org.apache.turbine.util.assemblerbroker.python.PythonActionFactory

services.AssemblerBrokerService.python.path=/path/to/python
</pre></div>
  
    <p>
        The first two registers the Python Assembler Factories with the
        AssemblerBrokerService.  The last line tells the Python interpreter
        where to find all the .py files for your application.
    </p>
    <p>
        In the root of your services.AssemblerBrokerService.python.path
        you need to add a file named config.py that looks like this:
    </p>


    <div class="source"><pre>
import java

from java.io import *
from java.util import *

sys.add_package("org.apache.turbine.modules.screens")
sys.add_package("org.apache.turbine.modules")
sys.add_package("org.apache.turbine.util.db")
sys.add_package("org.apache.turbine.util")
sys.add_package("org.apache.turbine.services.security.TurbineSecurity")
sys.add_package("org.webmacro.servlet")


from org.apache.turbine.modules.screens  import WebMacroSiteScreen
from org.apache.turbine.modules          import Action
from org.apache.turbine.util.db          import Criteria
from org.apache.turbine.util             import RunData
from org.webmacro.servlet                import WebContext
from org.apache.turbine.services.security   import TurbineSecurity
</pre></div>
  

      <p>
        JPython sometimes gets a bit confused with the Servlet Engine
        classloader, which forces us to call sys.add_package for each java
        package that we wish to use in our Python code.  You also need to
        import all the classes that you wish to use explicitly.  You needn't
        add the classes here, but it avoid some duplicate declarations at the
        top of each screen/action.
    </p>
    </div><div class="section"><a name="Using_Python_with_Turbine"></a><h2>Using Python with Turbine</h2>
    <p>
        To create python screens we use exactly the same methodology than for
        normal java screens.  First you need a /screens subdirectory in your
        services.AssemblerBrokerService.python.path.  This is where your
        screen code will live.  Layouts goes in /layouts, actions in /actions
        and so forth (just remember to register the appropriate assembler
        factories).
    </p>
    <p>
        I'm going to create a sample WebMacro screen.  First we need a .py file
        where this screen can live.  The .py file should have the same name as
        your .wm file and it must be all lower case.  Inside this file we
        create a new class with the same name as the file, but in this the
        first letter is uppercase (the rest is always lower case).  To override
        a method is fairly simple (just create a new method with the same
        name).
    </p>
    <p>
        There is one problem however - Python does not support method
        overloading based on type signatures, so usually the simplest for is
        used, which is doBuildTemplate( RunData data ) for WebMacroSiteScreen
        in stead of doBuildTemplate( RunData data, WebContext context ).  You
        have two options to overcome this problem. (1) Create a new superclass
        that exposes a method under a different name or (2) just call
        getContext in your python code.  I usually just go for the second
        option because it is fairly straight forward anyway.
    </p>
    <p>
        Now for the code.  Let's create a screen called Test.  First create a
        test.wm file (I assumer everybody knows how to do this).  Now create a
        test.py and place it in the python-path/screens directory.  It should
        look something like this:
    </p>


    <div class="source"><pre>
class Subjectslist(WebMacroSiteScreen):
   def doBuildTemplate (self,data):
        context = self.getContext(data)
        context.put ("me","Leon")
        context.put ("text","Python is cool");
</pre></div>
  

    <p>
        For more information about the self parameter see the Python docs.  You
        can call any java code that you would normally be able to use (just
        remember to add it to conf.py) including database, services, etc. You
        can also freely use any of the Python built-in types and any Python
        module that was built on 100% pure Python.
    </p>
  </div></div></div><div class="clear"><hr></hr></div><div id="footer"><div class="xright">© 2000-2008, Apache Software Foundation</div><div class="clear"><hr></hr></div></div></body></html>