<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.9.2 from xdocs/howto\python-howto.xml at 15 September 2021
 | Rendered using Apache Maven Fluido Skin 1.9
-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 1.9.2" />
    <title>Apache Turbine &#x2013; Python Howto</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.9.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />
    <script src="../js/apache-maven-fluido-1.9.min.js"></script>
<link rel="icon" type="image/png" sizes="48x48" href="./images/favicon.ico"> 
      <link rel="icon" type="image/png" sizes="48x48" href="../images/favicon.ico"> 
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
  </head>
  <body class="topBarDisabled">
    <div class="container-fluid">
      <header>
        <div id="banner">
          <div class="pull-left"><a href="../../" id="bannerLeft" title="Apache Turbine"><img src="../images/turbine-project-apache-separate.png"  alt="Apache Turbine"/></a></div>
          <div class="pull-right"><div id="bannerRight"><img src="../images/logo.gif"  alt=""/></div>
</div>
          <div class="clear"><hr/></div>
        </div>

        <div id="breadcrumbs">
          <ul class="breadcrumb">
        <li id="publishDate">Last Published: 15 September 2021<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 5.1-SNAPSHOT</li>
      <li class="pull-right"><span class="divider">|</span>
<a href="https://turbine.apache.org/fulcrum/" class="externalLink" title="Fulcrum">Fulcrum</a></li>
      <li class="pull-right"><span class="divider">|</span>
<a href="https://turbine.apache.org/" class="externalLink" title="Turbine">Turbine</a></li>
      <li class="pull-right"><a href="https://www.apache.org" class="externalLink" title="Apache">Apache</a></li>
          </ul>
        </div>
      </header>
      <div class="row-fluid">
        <header id="leftColumn" class="span2">
          <nav class="well sidebar-nav">
  <ul class="nav nav-list">
   <li class="nav-header">General Information</li>
    <li><a href="../index.html" title="Overview"><span class="none"></span>Overview</a></li>
    <li><a href="../features.html" title="Features"><span class="none"></span>Features</a></li>
    <li><a href="../fsd.html" title="Specification"><span class="none"></span>Specification</a></li>
    <li><a href="../getting-started.html" title="Getting Started"><span class="none"></span>Getting Started</a></li>
    <li><a href="../how-to-build.html" title="Howto Build Turbine"><span class="none"></span>Howto Build Turbine</a></li>
    <li><a href="../changes-report.html" title="Changes"><span class="none"></span>Changes</a></li>
   <li class="nav-header">Documentation</li>
    <li><a href="../services/index.html" title="Services"><span class="icon-chevron-right"></span>Services</a></li>
    <li><a href="../howto/index.html" title="Howtos"><span class="icon-chevron-down"></span>Howtos</a>
     <ul class="nav nav-list">
      <li><a href="../howto/action-event-howto.html" title="Action Events Howto"><span class="none"></span>Action Events Howto</a></li>
      <li><a href="../howto/annotations.html" title="Annotations Howto"><span class="none"></span>Annotations Howto</a></li>
      <li><a href="../howto/configuration-howto.html" title="Configuration Howto"><span class="none"></span>Configuration Howto</a></li>
      <li><a href="../howto/extend-user-howto.html" title="Extend User Howto"><span class="none"></span>Extend User Howto</a></li>
      <li><a href="../howto/hibernate-howto.html" title="Hibernate OM Howto"><span class="none"></span>Hibernate OM Howto</a></li>
      <li><a href="../howto/intake-howto.html" title="Intake Howto"><span class="none"></span>Intake Howto</a></li>
      <li><a href="../howto/jsp-howto.html" title="JSP Howto"><span class="none"></span>JSP Howto</a></li>
      <li><a href="../howto/migrate-from-2_1-howto.html" title="Migrating from 2.1 to 2.2"><span class="none"></span>Migrating from 2.1 to 2.2</a></li>
      <li><a href="../howto/migrate-from-2_2-howto.html" title="Migrating from 2.2 to 2.3"><span class="none"></span>Migrating from 2.2 to 2.3</a></li>
      <li><a href="../howto/migrate-from-2_3-howto.html" title="Migrating from 2.3 to 4.0"><span class="none"></span>Migrating from 2.3 to 4.0</a></li>
      <li><a href="../howto/migrate-from-4_0-howto.html" title="Migrating from 4.0 to 5.0"><span class="none"></span>Migrating from 4.0 to 5.0</a></li>
      <li><a href="../howto/pullmodel-howto.html" title="Pull Model Howto"><span class="none"></span>Pull Model Howto</a></li>
      <li class="active"><a href="#"><span class="none"></span>Python Howto</a></li>
      <li><a href="../howto/security-howto.html" title="Security Howto"><span class="none"></span>Security Howto</a></li>
      <li><a href="../howto/services-howto.html" title="Services Howto"><span class="none"></span>Services Howto</a></li>
      <li><a href="../howto/url-mapper-howto.html" title="URL Simplifier Howto"><span class="none"></span>URL Simplifier Howto</a></li>
      <li><a href="../howto/url-rewriting-howto.html" title="URL Rewriting Howto"><span class="none"></span>URL Rewriting Howto</a></li>
      <li><a href="../howto/context-howto.html" title="Velocity Context Howto"><span class="none"></span>Velocity Context Howto</a></li>
      <li><a href="../howto/velocity-site-howto.html" title="Velocity Site Howto"><span class="none"></span>Velocity Site Howto</a></li>
      <li><a href="../howto/velocityonlylayout-howto.html" title="VelocityOnlyLayout Howto"><span class="none"></span>VelocityOnlyLayout Howto</a></li>
     </ul></li>
    <li><a href="https://cwiki.apache.org/confluence/display/TURBINE" class="externalLink" title="Wiki"><span class="none"></span>Wiki</a></li>
    <li><a href="../apidocs/index.html" title="JavaDocs"><span class="none"></span>JavaDocs</a></li>
   <li class="nav-header">Development</li>
    <li><a href="../proposals.html" title="Proposals"><span class="none"></span>Proposals</a></li>
    <li><a href="../how-to-help.html" title="How To Help"><span class="none"></span>How To Help</a></li>
    <li><a href="../todo.html" title="Todo"><span class="none"></span>Todo</a></li>
   <li class="nav-header">Project Documentation</li>
    <li><a href="../project-info.html" title="Project Information"><span class="icon-chevron-right"></span>Project Information</a></li>
    <li><a href="../project-reports.html" title="Project Reports"><span class="icon-chevron-right"></span>Project Reports</a></li>
   <li class="nav-header">Apache</li>
    <li><a href="https://www.apache.org/" class="externalLink" title="Apache Website"><span class="none"></span>Apache Website</a></li>
    <li><a href="https://www.apache.org/licenses/" class="externalLink" title="License"><span class="none"></span>License</a></li>
    <li><a href="https://www.apache.org/foundation/how-it-works.html" class="externalLink" title="How the ASF works"><span class="none"></span>How the ASF works</a></li>
    <li><a href="https://www.apache.org/foundation/sponsorship.html" class="externalLink" title="Sponsorship"><span class="none"></span>Sponsorship</a></li>
    <li><a href="https://www.apache.org/foundation/thanks.html" class="externalLink" title="Thanks"><span class="none"></span>Thanks</a></li>
    <li><a href="https://www.apache.org/security/" class="externalLink" title="Security"><span class="none"></span>Security</a></li>
  </ul>
          </nav>
          <div class="well sidebar-nav">
            <hr />
            <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
<a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="../images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </header>
        <main id="bodyColumn"  class="span10" >


 
  <section>
<h2><a name="Turbine_Python_Support"></a>Turbine Python Support</h2>
  
<p>
    Turbine has support for creating assemblers (see the <a href="fsd.html">
    specifications</a>) with Python, by making use of
    <a class="externalLink" href="http://www.jpython.org">JPython technology</a>.
  </p>
  
<p>
    The first question that comes to mind is why one would want do to something
    like this.  Here are some of the reasons you might want to do this:
  </p>
    
<ul>
        
<li>
            Python is an interpreted language which means that you do not have
            to recompile and copy a new jar each time you make changes.
        </li>

        
<li>
            Although Python is interpreted it is compiled to java bytecode.
            Performance is on par with native java code.
        </li>

        
<li>
            Python is very easy to learn.  This, together with the fact that
            you don't need to use a compiler, makes it possible for people with
            little java experience to create screens.
        </li>

        
<li>
            You can rapidly build a prototype using python, and later on find
            that it is not necessary to systematically move to java :-)
        </li>
    </ul>
  </section>

  <section>
<h2><a name="Setting_Up_Python_for_Turbine"></a>Setting Up Python for Turbine</h2>
    
<p>
        The first thing is to download JPython from www.jpython.org and copy
        the jpython.jar file into your turibe/lib directory.  Now you need to
        prepare and compile the jpython files like this:
</p>
<div class="source"><pre class="prettyprint">
build prepare-python
build jar
</pre></div>
        This will create a new turbine library that contains the Python code.
        You need to copy this new .jar file to your application's lib
        directory.
    
    
<p>
        Now we need to edit the TurbineResources.properties.  Add the following
        keys to your application's properties:
    </p>

<div class="source"><pre class="prettyprint">
services.AssemblerBrokerService.assembler.screen=
org.apache.turbine.util.assemblerbroker.python.PythonScreenFactory
services.AssemblerBrokerService.assembler.action=
org.apache.turbine.util.assemblerbroker.python.PythonActionFactory

services.AssemblerBrokerService.python.path=/path/to/python
</pre></div>
    
<p>
        The first two registers the Python Assembler Factories with the
        AssemblerBrokerService.  The last line tells the Python interpreter
        where to find all the .py files for your application.
    </p>
    
<p>
        In the root of your services.AssemblerBrokerService.python.path
        you need to add a file named config.py that looks like this:
    </p>


<div class="source"><pre class="prettyprint">
import java

from java.io import *
from java.util import *

sys.add_package(&quot;org.apache.turbine.modules.screens&quot;)
sys.add_package(&quot;org.apache.turbine.modules&quot;)
sys.add_package(&quot;org.apache.turbine.util.db&quot;)
sys.add_package(&quot;org.apache.turbine.util&quot;)
sys.add_package(&quot;org.apache.turbine.services.security.TurbineSecurity&quot;)
sys.add_package(&quot;org.webmacro.servlet&quot;)


from org.apache.turbine.modules.screens  import WebMacroSiteScreen
from org.apache.turbine.modules          import Action
from org.apache.turbine.util.db          import Criteria
from org.apache.turbine.util             import RunData
from org.webmacro.servlet                import WebContext
from org.apache.turbine.services.security   import TurbineSecurity
</pre></div>

      
<p>
        JPython sometimes gets a bit confused with the Servlet Engine
        classloader, which forces us to call sys.add_package for each java
        package that we wish to use in our Python code.  You also need to
        import all the classes that you wish to use explicitly.  You needn't
        add the classes here, but it avoid some duplicate declarations at the
        top of each screen/action.
    </p>
    </section>

    <section>
<h2><a name="Using_Python_with_Turbine"></a>Using Python with Turbine</h2>
    
<p>
        To create python screens we use exactly the same methodology than for
        normal java screens.  First you need a /screens subdirectory in your
        services.AssemblerBrokerService.python.path.  This is where your
        screen code will live.  Layouts goes in /layouts, actions in /actions
        and so forth (just remember to register the appropriate assembler
        factories).
    </p>
    
<p>
        I'm going to create a sample WebMacro screen.  First we need a .py file
        where this screen can live.  The .py file should have the same name as
        your .wm file and it must be all lower case.  Inside this file we
        create a new class with the same name as the file, but in this the
        first letter is uppercase (the rest is always lower case).  To override
        a method is fairly simple (just create a new method with the same
        name).
    </p>
    
<p>
        There is one problem however - Python does not support method
        overloading based on type signatures, so usually the simplest for is
        used, which is doBuildTemplate( RunData data ) for WebMacroSiteScreen
        in stead of doBuildTemplate( RunData data, WebContext context ).  You
        have two options to overcome this problem. (1) Create a new superclass
        that exposes a method under a different name or (2) just call
        getContext in your python code.  I usually just go for the second
        option because it is fairly straight forward anyway.
    </p>
    
<p>
        Now for the code.  Let's create a screen called Test.  First create a
        test.wm file (I assumer everybody knows how to do this).  Now create a
        test.py and place it in the python-path/screens directory.  It should
        look something like this:
    </p>


<div class="source"><pre class="prettyprint">
class Subjectslist(WebMacroSiteScreen):
   def doBuildTemplate (self,data):
        context = self.getContext(data)
        context.put (&quot;me&quot;,&quot;Leon&quot;)
        context.put (&quot;text&quot;,&quot;Python is cool&quot;);
</pre></div>

    
<p>
        For more information about the self parameter see the Python docs.  You
        can call any java code that you would normally be able to use (just
        remember to add it to conf.py) including database, services, etc. You
        can also freely use any of the Python built-in types and any Python
        module that was built on 100% pure Python.
    </p>
  </section>

 

        </main>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>&#169;      2000&#x2013;2021
<a href="https://www.apache.org/">The Apache Software Foundation</a>
</p>
        </div>
      </div>
    </footer>
  </body>
</html>
