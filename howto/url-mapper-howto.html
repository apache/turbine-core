<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.11.1 from xdocs/howto\url-mapper-howto.xml at 26 January 2024
 | Rendered using Apache Maven Fluido Skin 1.9
-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 1.11.1" />
    <title>Apache Turbine &#x2013; URL Mapper Howto</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.9.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />
    <script src="../js/apache-maven-fluido-1.9.min.js"></script>
<link rel="icon" type="image/png" sizes="48x48" href="./images/favicon.ico"> 
      <link rel="icon" type="image/png" sizes="48x48" href="../images/favicon.ico"> 
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
  </head>
  <body class="topBarDisabled">
    <a href="https://github.com/apache/turbine-core">
      <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 10000;"
        src="https://s3.amazonaws.com/github/ribbons/forkme_right_orange_ff7600.png"
        alt="Fork me on GitHub">
    </a>
    <div class="container-fluid">
      <header>
        <div id="banner">
          <div class="pull-left"><a href="../../" id="bannerLeft" title="Apache Turbine"><img src="../images/turbine-project-apache-separate.png"  alt="Apache Turbine"/></a></div>
          <div class="pull-right"><div id="bannerRight"><img src="../images/logo.gif"  alt=""/></div>
</div>
          <div class="clear"><hr/></div>
        </div>

        <div id="breadcrumbs">
          <ul class="breadcrumb">
        <li id="publishDate">Last Published: 26 January 2024<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 6.0</li>
      <li class="pull-right"><span class="divider">|</span>
<a href="https://turbine.apache.org/fulcrum/" class="externalLink" title="Fulcrum">Fulcrum</a></li>
      <li class="pull-right"><span class="divider">|</span>
<a href="https://turbine.apache.org/" class="externalLink" title="Turbine">Turbine</a></li>
      <li class="pull-right"><a href="https://www.apache.org" class="externalLink" title="Apache">Apache</a></li>
          </ul>
        </div>
      </header>
      <div class="row-fluid">
        <header id="leftColumn" class="span2">
          <nav class="well sidebar-nav">
  <ul class="nav nav-list">
   <li class="nav-header">General Information</li>
    <li><a href="../index.html" title="Overview"><span class="none"></span>Overview</a></li>
    <li><a href="../features.html" title="Features"><span class="none"></span>Features</a></li>
    <li><a href="../fsd.html" title="Specification"><span class="none"></span>Specification</a></li>
    <li><a href="../getting-started.html" title="Getting Started"><span class="none"></span>Getting Started</a></li>
    <li><a href="../how-to-build.html" title="Howto Build Turbine"><span class="none"></span>Howto Build Turbine</a></li>
    <li><a href="../changes-report.html" title="Changes"><span class="none"></span>Changes</a></li>
   <li class="nav-header">Documentation</li>
    <li><a href="../services/index.html" title="Services"><span class="icon-chevron-right"></span>Services</a></li>
    <li><a href="../howto/index.html" title="Howtos"><span class="icon-chevron-down"></span>Howtos</a>
     <ul class="nav nav-list">
      <li><a href="../howto/action-event-howto.html" title="Action Events Howto"><span class="none"></span>Action Events Howto</a></li>
      <li><a href="../howto/annotations.html" title="Annotations Howto"><span class="none"></span>Annotations Howto</a></li>
      <li><a href="../howto/configuration-howto.html" title="Configuration Howto"><span class="none"></span>Configuration Howto</a></li>
      <li><a href="../howto/extend-user-howto.html" title="Extend User Howto"><span class="none"></span>Extend User Howto</a></li>
      <li><a href="../howto/hibernate-howto.html" title="Hibernate OM Howto"><span class="none"></span>Hibernate OM Howto</a></li>
      <li><a href="../howto/intake-howto.html" title="Intake Howto"><span class="none"></span>Intake Howto</a></li>
      <li><a href="../howto/jsp-howto.html" title="JSP Howto"><span class="none"></span>JSP Howto</a></li>
      <li><a href="../howto/migrate-from-2_1-howto.html" title="Migrating from 2.1 to 2.2"><span class="none"></span>Migrating from 2.1 to 2.2</a></li>
      <li><a href="../howto/migrate-from-2_2-howto.html" title="Migrating from 2.2 to 2.3"><span class="none"></span>Migrating from 2.2 to 2.3</a></li>
      <li><a href="../howto/migrate-from-2_3-howto.html" title="Migrating from 2.3 to 4.0"><span class="none"></span>Migrating from 2.3 to 4.0</a></li>
      <li><a href="../howto/migrate-from-4_0-howto.html" title="Migrating from 4.0 to 5.0"><span class="none"></span>Migrating from 4.0 to 5.0</a></li>
      <li><a href="../howto/pullmodel-howto.html" title="Pull Model Howto"><span class="none"></span>Pull Model Howto</a></li>
      <li><a href="../howto/python-howto.html" title="Python Howto"><span class="none"></span>Python Howto</a></li>
      <li><a href="../howto/security-howto.html" title="Security Howto"><span class="none"></span>Security Howto</a></li>
      <li><a href="../howto/services-howto.html" title="Services Howto"><span class="none"></span>Services Howto</a></li>
      <li class="active"><a href="#"><span class="none"></span>URL Mapper Howto</a></li>
      <li><a href="../howto/url-rewriting-howto.html" title="URL Rewriting Howto"><span class="none"></span>URL Rewriting Howto</a></li>
      <li><a href="../howto/context-howto.html" title="Velocity Context Howto"><span class="none"></span>Velocity Context Howto</a></li>
      <li><a href="../howto/velocity-site-howto.html" title="Velocity Site Howto"><span class="none"></span>Velocity Site Howto</a></li>
      <li><a href="../howto/velocityonlylayout-howto.html" title="VelocityOnlyLayout Howto"><span class="none"></span>VelocityOnlyLayout Howto</a></li>
     </ul></li>
    <li><a href="https://cwiki.apache.org/confluence/display/TURBINE" class="externalLink" title="Wiki"><span class="none"></span>Wiki</a></li>
    <li><a href="../apidocs/index.html" title="JavaDocs"><span class="none"></span>JavaDocs</a></li>
   <li class="nav-header">Development</li>
    <li><a href="../proposals.html" title="Proposals"><span class="none"></span>Proposals</a></li>
    <li><a href="../how-to-help.html" title="How To Help"><span class="none"></span>How To Help</a></li>
    <li><a href="../todo.html" title="Todo"><span class="none"></span>Todo</a></li>
   <li class="nav-header">Project Documentation</li>
    <li><a href="../project-info.html" title="Project Information"><span class="icon-chevron-right"></span>Project Information</a></li>
    <li><a href="../project-reports.html" title="Project Reports"><span class="icon-chevron-right"></span>Project Reports</a></li>
   <li class="nav-header">Apache</li>
    <li><a href="https://www.apache.org/" class="externalLink" title="Apache Website"><span class="none"></span>Apache Website</a></li>
    <li><a href="https://www.apache.org/licenses/" class="externalLink" title="License"><span class="none"></span>License</a></li>
    <li><a href="https://www.apache.org/foundation/how-it-works.html" class="externalLink" title="How the ASF works"><span class="none"></span>How the ASF works</a></li>
    <li><a href="https://www.apache.org/foundation/sponsorship.html" class="externalLink" title="Sponsorship"><span class="none"></span>Sponsorship</a></li>
    <li><a href="https://www.apache.org/foundation/thanks.html" class="externalLink" title="Thanks"><span class="none"></span>Thanks</a></li>
    <li><a href="https://www.apache.org/security/" class="externalLink" title="Security"><span class="none"></span>Security</a></li>
  </ul>
          </nav>
          <div class="well sidebar-nav">
<form id="search-form" action="https://www.google.com/search" method="get" >
  <input value="http://turbine.apache.org/turbine-core" name="sitesearch" type="hidden"/>
  <input class="search-query" name="q" id="query" type="text" />
</form>
<script>asyncJs( 'https://cse.google.com/brand?form=search-form' )</script>
            <hr />
            <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
<a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="../images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </header>
        <main id="bodyColumn"  class="span10" >


 

<section>
<h2><a name="Introduction"></a>Introduction</h2>


<p>
Unaltered Turbine URLs may look like this:
<code>http://www.foo.com:8080/CONTEXT/servlet/MAPPING/template/Foo.vm</code>.<br />
But you want shorter URLs? Maybe this URL would suit you better:
<code>http://www.foo.com:8080/CONTEXT/servlet/beautiful/world</code>
</p>

This HOWTO describes, how you can control the pathinfo or query part of a url (behind the webapproot and the context) and the context with a mapping (routing) file 
defined in xml, json or yaml format to become more simplified or beautiful! 

</section>

<section>
<h2><a name="Turbine_URLMapper_Configuration"></a>Turbine URLMapper Configuration</h2>


<p>
You need to
</p>
<ul>

<li>register the URL Mapper service in turbine configuration (TR.properties) </li>

<li>register the valve in the pipeline (turbine-classic-pipeline.xml)</li>
</ul> 




<p>Consider the following example configuration:

MappedTemplateLink is for now optional, you can add it as a separate tool or just replace the existing TemplateLink.
</p>


<div class="source"><pre class="prettyprint">
	# -------------------------------------------------------------------
	#
	#  U R L  M A P P E R  S E R V I C E
	#
	# -------------------------------------------------------------------
	
	# required
	services.URLMapperService.classname=org.apache.turbine.services.urlmapper.TurbineURLMapperService
	
	# configFile is required here! xml, json and yml supported as extension.
	services.URLMapperService.configFile = /conf/turbine-url-mapping.xml
	
	# new mapper (optional)
	tool.request.mlink=org.apache.turbine.services.urlmapper.MappedTemplateLink
	# tool.request.jlink= org.apache.turbine.services.pull.tools.TemplateLink
</pre></div>


<p>To resolve a provided / mapped URL add the valve into pipeline (pipeline.default.descriptor = /conf/turbine-classic-pipeline.xml). 
</p>


<div class="source"><pre class="prettyprint">
  &lt;valves&gt;
    &lt;valve&gt;org.apache.turbine.services.urlmapper.URLMapperValve&lt;/valve&gt;
    ...

</pre></div>


<p>This will check if the provided URL matches any pattern, resolves it given in the path or implicitly as defined in

the URLMapperService's configfile.</p> 

</section>

<section>
<h2><a name="Define_your_patterns"></a>Define your patterns</h2>


<p>The URL Mapping Mechanism uses a well defined pattern format. 
The pattern format scheme is defined as follows, e.g. in JSON:</p>


<div class="source"><pre class="prettyprint">
 &quot;pattern&quot;:  &quot;/(?&lt;webAppRoot&gt;[.\\-\\w]+)/(?&lt;contextPath&gt;\\w+)/(?&lt;resolvableParam&gt;\\w+)/beautifulname&quot;
</pre></div>


<p>That is <b>resolvableParam</b> is just a specific parameter name or key, which should be resolved after the context slash and before the next URL part, which starts with &quot;/beatifulname&quot;. 

It  has to be set like this</p> 


<div class="source"><pre class="prettyprint">
 /(?&lt;resolvableParam&gt;\\w+)
</pre></div>

Technically this isa non matching named group, with the group name <b>resolvableParam</b> and 

in this case a sequence of alphabetical characters with minimal length of 1. 

The same is true for the predefined <b>webAppRoot</b>  and <b>contextPath</b>. 


<p>Another condition to be met, is that the parameter name must follow the &quot;Java Named Group pattern characters restriction&quot;:</p>


<div class="source"><pre class="prettyprint">
 NAMED_GROUPS_PATTERN = Pattern.compile(&quot;(?&lt;([a-zA-Z][a-zA-Z0-9]*)&gt;.+?)&quot;);
</pre></div>


<p>
Any parameter is resolved as a <i>group name</i>
 (<a class="externalLink" href="https://docs.oracle.com/javase/8/docs/api/java/util/regex/Pattern.html">Java Pattern-&gt;Groups and Capturing-&gt;Group name</a>).
 
These group names are predefined (symbolic group name)):
 
</p>
<ul>
<li><b>&lt;webAppRoot&gt;</b></li>
<li><b>&lt;contextPath&gt;</b></li></ul>

Be aware, that this does not allow replacing parameters containing other characters (e.g underscore or hyphens). You may use implicit parameter matching. 

Following is an example for a configuration : 



<div class="source"><pre class="prettyprint">
&lt;url-mapping name=&quot;default&quot;&gt;
    &lt;maps&gt;
        &lt;map&gt;
            &lt;pattern&gt;/(?&amp;lt;webAppRoot&amp;gt;[.\\-\\w]+)/(?&amp;lt;contextPath&amp;gt;\w+)/book/(?&amp;lt;bookId&amp;gt;\d+)&lt;/pattern&gt;
            &lt;implicit-parameters&gt;
                &lt;parameter key=&quot;template&quot;&gt;Book.vm&lt;/parameter&gt;
                &lt;parameter key=&quot;detail&quot;&gt;0&lt;/parameter&gt;
            &lt;/implicit-parameters&gt;
        &lt;/map&gt;
        ...
</pre></div>


<p>Three parameters are evaluated:

</p>
<ul>
<li>a parameter name <b>template</b> and value <b>Book.vm</b></li>

<li>a parameter <b>detail</b> and value <b>0</b></li>

<li>a parameter <b>bookId</b> with <i>any</i> value, e.g. <b>4</b></li>
</ul>
This will be converted, if matched, to an URL like <b>/book/4</b>. 
The pattern uses type restrictions for the value, e.g. number for the bookId and a extended character set for the webAppRoot, which will be applied in (back resolving) <b>mapFromURL</b>.



<p>Another example in <b>JSON</b> format, which is much more readable, if not viewing in a browser is here (showing a shortened URL by replacing two parameters):</p>


<div class="source"><pre class="prettyprint">
{
  &quot;name&quot;: &quot;default&quot;,
  &quot;maps&quot;: [
	{
		&quot;pattern&quot;: &quot;/(?&lt;webAppRoot&gt;[\\w]+)/(?&lt;contextPath&gt;\\w+)/register&quot;,
		&quot;implicit-parameters&quot;: {
			&quot;page&quot;: &quot;Register&quot;,
			&quot;role&quot;: &quot;anon&quot;
		}
	},
        ...
</pre></div>

</section>

<section>
<h2><a name="Service_Description"></a>Service Description</h2>


<p>The main methods of the service <b>TurbineURLMapperService</b> are</p> 


<ul>

<li><b>mapToUrl</b>, which as the Javadoc explains &quot;maps a set of parameters (contained in TurbineURI PathInfo and QueryData) to a TurbineURIs&quot;</li>

<li><b>mapFromUrl</b>, which &quot;maps a simplified URL to a set of parameters&quot;</li>
</ul> 

  <section>
<h3><a name="Matrix"></a>Matrix</h3>
      
<table border="0" class="table table-striped">
        
<tr class="a">
         
<th colspan="6">Turbine URL Mapper Model</th>
        </tr>
        
<tr class="b">
          
<th>Mechanism</th>
<th>Method</th>
<th>Pattern</th>
<th>Implicit Param</th>
<th>Override Param</th>
<th>Ignore Param</th>
        </tr>
       
        
<tr class="a">
<th>Converts Parameterized URL to simplified URL</th>
<th>mapToUrl</th>
<td>
         &quot;Match Group Name&quot;: The pattern of the target URL after evaluation of parameters. If a group name is set, a matching parameter key must be provided and the value will replace the group name in the target URL.</td>
         
<td>&quot;Exact Filter&quot;, &quot;Reduce&quot;: If a parameter key is is set implicitely, both key and value must exactly matched by a parameter pair in the provided (unmapped) URI. It will then be removed</td>
         
<td>- An override could be achieved by hard coding it in the pattern and filterign in implicit param. 
         On the other hand you can then ignore the parameter</td>
         
<td>The parameter will be removed from the required parameter key set and also from the target URL if it is provided as a group name</td></tr>
        
        
<tr class="b">
<th>Resolves URL to Params for evaluating by the backend</th>
<th>mapFromUrl</th>
<td>
        The pattern of the URL to be matched to evaluate parameter resolving</td>
        
<td>Param key/value will be set implicitely</td>
        
<td>Overrides (provided) URL parameter with provided value</td>
        
<td>will remove parameter key/value from result parameter list, even if provided as capturing group name</td></tr>
      </table>
    </section>
    
   
<p>N.B. Symbolic group names <i>webAppRoot</i> and <i>context</i> could not be ignored or overridden!</p>
   
   
</section>
<section>
<h2><a name="Usage"></a>Usage</h2>


<p>
Use the methods getRelative or getAbsoluteLink of the provided convenience class MappedTemplateLink class (of type TemplateLink) 
in a velocity template like this:
</p>


<div class="source"><pre class="prettyprint">
  
  $mlink.addPathInfo(&quot;world&quot;,&quot;nice&quot;).getRelativeLink()
  ## should result into a URL: /beautiful/world
  
</pre></div>


<p>

<p>Alternatively you can use the service explicitely in Java, e.g. in a Java Action or other class if you inject the URLMapperService (or provide this in a shared  controller class).</p>


<div class="source"><pre class="prettyprint">

   // inside any assembler you may alternatively use annotation 
   // @TurbineService( &quot;URLMapperService&quot; ) urlMapper;
   
   URLMapperService urlMapper = (URLMapperService) TurbineServices.getInstance().getService(URLMapperService.SERVICE_NAME);

  // Any turbineURI ..e.g. from PoolService or 
  TurbineURI uri  ... 
          
  urlMapper.mapToURL( uri );

  
  // use it, e.g by putting it into a velocity context (org.apache.velocity.context.Context(
  context.put(&quot;myLink&quot;, link);
     
</pre></div>

 
More examples ...



</section>



        </main>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>&#169;      2000&#x2013;2024
<a href="https://www.apache.org/">The Apache Software Foundation</a>
</p>
        </div>
      </div>
    </footer>
  </body>
</html>
