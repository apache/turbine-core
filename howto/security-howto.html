<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Apache Maven Doxia Site Renderer 1.4 at 21 December 2015 -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Apache Turbine - 
  Security Howto</title>
    <style type="text/css" media="all">
      @import url("../css/maven-base.css");
      @import url("../css/maven-theme.css");
      @import url("../css/site.css");
    </style>
    <link rel="stylesheet" href="../css/print.css" type="text/css" media="print" />
    <meta name="Date-Revision-yyyymmdd" content="20151221" />
    <meta http-equiv="Content-Language" content="en" />
        
        </head>
  <body class="composite">
    <div id="banner">
                                      <a href="../../../" id="bannerLeft" title="Apache Turbine">
                                                <img src="../images/turbine-project.png" alt="Apache Turbine" />
                </a>
                          <div id="bannerRight">
                                                <img src="../images/logo.gif" alt="Apache Turbine" />
                </div>
            <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
            
                    
                <div class="xleft">
        <span id="publishDate">Last Published: 21 December 2015</span>
                  &nbsp;| <span id="projectVersion">Version: 4.0-M2</span>
                      </div>
            <div class="xright">                    <a href="http://www.apache.org" class="externalLink" title="Apache">Apache</a>
            |
                        <a href="../../../" title="Turbine">Turbine</a>
            |
                        <a href="../../../fulcrum/" title="Fulcrum">Fulcrum</a>
              
                    
      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
             
                    
                                <h5>General Information</h5>
                  <ul>
                  <li class="none">
                          <a href="../index.html" title="Overview">Overview</a>
            </li>
                  <li class="none">
                          <a href="../features.html" title="Features">Features</a>
            </li>
                  <li class="none">
                          <a href="../fsd.html" title="Specification">Specification</a>
            </li>
                  <li class="none">
                          <a href="../getting-started.html" title="Getting Started">Getting Started</a>
            </li>
                  <li class="none">
                          <a href="../how-to-build.html" title="Howto Build Turbine">Howto Build Turbine</a>
            </li>
                  <li class="none">
                          <a href="../changes-report.html" title="Changes">Changes</a>
            </li>
          </ul>
                       <h5>Documentation</h5>
                  <ul>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <li class="collapsed">
                          <a href="../services/index.html" title="Services">Services</a>
                  </li>
                                                                                                                                                                                                                                                                                                                                                                                                <li class="expanded">
                          <a href="../howto/index.html" title="Howtos">Howtos</a>
                    <ul>
                      <li class="none">
                          <a href="../howto/action-event-howto.html" title="Action Events Howto">Action Events Howto</a>
            </li>
                      <li class="none">
                          <a href="../howto/annotations.html" title="Annotations Howto">Annotations Howto</a>
            </li>
                      <li class="none">
                          <a href="../howto/configuration-howto.html" title="Configuration Howto">Configuration Howto</a>
            </li>
                      <li class="none">
                          <a href="../howto/extend-user-howto.html" title="Extend User Howto">Extend User Howto</a>
            </li>
                      <li class="none">
                          <a href="../howto/hibernate-howto.html" title="Hibernate OM Howto">Hibernate OM Howto</a>
            </li>
                      <li class="none">
                          <a href="../howto/intake-howto.html" title="Intake Howto">Intake Howto</a>
            </li>
                      <li class="none">
                          <a href="../howto/jsp-howto.html" title="JSP Howto">JSP Howto</a>
            </li>
                      <li class="none">
                          <a href="../howto/migrate-from-2_1-howto.html" title="Migrating from 2.1 to 2.2">Migrating from 2.1 to 2.2</a>
            </li>
                      <li class="none">
                          <a href="../howto/migrate-from-2_2-howto.html" title="Migrating from 2.2 to 2.3">Migrating from 2.2 to 2.3</a>
            </li>
                      <li class="none">
                          <a href="../howto/migrate-from-2_3-howto.html" title="Migrating from 2.3 to 4.0">Migrating from 2.3 to 4.0</a>
            </li>
                      <li class="none">
                          <a href="../howto/pullmodel-howto.html" title="Pull Model Howto">Pull Model Howto</a>
            </li>
                      <li class="none">
                          <a href="../howto/python-howto.html" title="Python Howto">Python Howto</a>
            </li>
                      <li class="none">
            <strong>Security Howto</strong>
          </li>
                      <li class="none">
                          <a href="../howto/services-howto.html" title="Services Howto">Services Howto</a>
            </li>
                      <li class="none">
                          <a href="../howto/url-rewriting-howto.html" title="URL rewriting Howto">URL rewriting Howto</a>
            </li>
                      <li class="none">
                          <a href="../howto/context-howto.html" title="Velocity Context Howto">Velocity Context Howto</a>
            </li>
                      <li class="none">
                          <a href="../howto/velocity-site-howto.html" title="Velocity Site Howto">Velocity Site Howto</a>
            </li>
                      <li class="none">
                          <a href="../howto/velocityonlylayout-howto.html" title="VelocityOnlyLayout Howto">VelocityOnlyLayout Howto</a>
            </li>
              </ul>
        </li>
                  <li class="none">
                          <a href="http://wiki.apache.org/turbine/FrontPage" class="externalLink" title="Wiki">Wiki</a>
            </li>
                  <li class="none">
                          <a href="../apidocs/index.html" title="JavaDocs">JavaDocs</a>
            </li>
          </ul>
                       <h5>Development</h5>
                  <ul>
                  <li class="none">
                          <a href="../proposals.html" title="Proposals">Proposals</a>
            </li>
                  <li class="none">
                          <a href="../how-to-help.html" title="How To Help">How To Help</a>
            </li>
                  <li class="none">
                          <a href="../todo.html" title="Todo">Todo</a>
            </li>
          </ul>
                       <h5>Project Documentation</h5>
                  <ul>
                                                                                                                                                                                                                                                                                            <li class="collapsed">
                          <a href="../project-info.html" title="Project Information">Project Information</a>
                  </li>
                                                                                                                                                                                                                                                                                            <li class="collapsed">
                          <a href="../project-reports.html" title="Project Reports">Project Reports</a>
                  </li>
          </ul>
                       <h5>Apache</h5>
                  <ul>
                  <li class="none">
                          <a href="http://www.apache.org/" class="externalLink" title="Apache Website">Apache Website</a>
            </li>
                  <li class="none">
                          <a href="http://www.apache.org/licenses/" class="externalLink" title="License">License</a>
            </li>
                  <li class="none">
                          <a href="http://www.apache.org/foundation/how-it-works.html" class="externalLink" title="How the ASF works">How the ASF works</a>
            </li>
                  <li class="none">
                          <a href="http://www.apache.org/foundation/sponsorship.html" class="externalLink" title="Sponsorship">Sponsorship</a>
            </li>
                  <li class="none">
                          <a href="http://www.apache.org/foundation/thanks.html" class="externalLink" title="Thanks">Thanks</a>
            </li>
                  <li class="none">
                          <a href="http://www.apache.org/security/" class="externalLink" title="Security">Security</a>
            </li>
          </ul>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="../images/logos/maven-feather.png" />
      </a>
                   
                    
            </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        <!-- Licensed to the Apache Software Foundation (ASF) under one
 or more contributor license agreements.  See the NOTICE file
 distributed with this work for additional information
 regarding copyright ownership.  The ASF licenses this file
 to you under the Apache License, Version 2.0 (the
 "License"); you may not use this file except in compliance
 with the License.  You may obtain a copy of the License at

   http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing,
 software distributed under the License is distributed on an
 "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 KIND, either express or implied.  See the License for the
 specific language governing permissions and limitations
 under the License. -->

 

<div class="section">
<h2>Turbine Security<a name="Turbine_Security"></a></h2>


<p>
The Turbine Security includes a <a href="../services/security-service.html">Security Service</a>
as well as Actions and Screens that can be extended in the Templating Services.
</p>

</div>


<!-- Start -->



<div class="section">
<h2>Users, Groups, Roles and Permissions<a name="Users_Groups_Roles_and_Permissions"></a></h2>


<p>
The default Relational Database schema that Turbine uses for the database security
service includes the
data structure for the managing of permissions.
The default or core schema can be viewed at;
</p>


<p>
</p>
<ul><a href="../turbine-schema.html">Turbine Core Schema</a></ul>



<p>
The main tables are TURBINE_GROUP, TURBINE_USER, TURBINE_ROLE and TURBINE_PERMISSION.
The Permissions are the individual actions a user is allowed to take in the system.
The Role is a container for the Permissions, in other words a Role can be made of
many Permissions. User is an account that is interaction with the System and the Group
is a something that a User would want to do something in. In the Turbine mailing lists
it has often been described in the same way as a project. In a project you have fulfill
a role, however a User doesnt &quot;belong&quot; to a project they merely have a role in that
project ( or group ). In this manner too a User can have many Roles within the one
Group. For instance a User may have the Role Developer in the Group, but may also have
the Role of Administrator as well. While initially confusing at first, as there
are no group-user or role-user containers, it is a flexible system and strong system.
</p>

</div>



<div class="section">
<h2>Access Control Lists<a name="Access_Control_Lists"></a></h2>


<p>
A User's interaction through the system is controlled by the Permissions they are
able to partake in. The AccessControlLists manage this information and present it via
RunData and User Interfaces to the application. The RunData interface through the
getACL() method presents the AccessControlList Object.
</p>


<div class="source">
<pre>
//get the AccessControlList Object
//from RunData
AccessControlList acl = data.getACL();

//check if the User ( from the http request )
//has permission to view the invoices
if( acl.hasPermission(&quot;viewinvoice&quot;) )
{
    data.setMessage(&quot;You have permission to view the invoices.&quot;);
    setTemplate(data, &quot;Invoice.vm&quot;);
}
else
{
    data.setMessage(&quot;You do not have Permission to view the Invoices&quot;);
    setTemplate(data, &quot;UnauthorizedRequest.vm&quot;);
}
</pre></div>


<p>
This will check if the User has permission to view this in the Global Group which
is useful for managing Anonymous Users as well as logged in Users across your
application. If however you need stronger security, such as only allowing users that
have logged in, and have a Role in a specific Group, the Permission will need to be
matched to the Group and User. As an example, assume one of your groups is &quot;Accounting&quot;
and the Invoice information is only to be viewed by Usersthat have a Role in Accounting
as well as the Permission &quot;viewinvoice&quot;, the above method would be re-written;
</p>


<div class="source">
<pre>
//get the User from RunData
User user = data.getUser();

//get the AccessControlList Object
//from RunData
AccessControlList acl = data.getACL();

//check if the User has logged in,
//has a role in the group and
//has permission to view the invoices
if( user.hasLoggedIn() &amp;&amp;
    acl.hasPermission(&quot;viewinvoice&quot;, &quot;Accounting&quot;) )
{
   data.setMessage(&quot;You have permission to view the invoices.&quot;);
   setTemplate(data, &quot;Invoice.vm&quot;);
}
else
{
   data.setMessage(&quot;You do not have Permission to view the Invoices&quot;);
   setTemplate(data, &quot;UnauthorizedRequest.vm&quot;);
}
</pre></div>


<p>
If instead the Permission could be across any of the Roles the User has, the
method acl.hasPermission(String permission, GroupSet groups), can be used. As
always check the Javadocs for more detail.
</p>

</div>


<div class="section">
<h2>Templates and Logging In<a name="Templates_and_Logging_In"></a></h2>


<p>
Managing Anonymous Users and Logged In Users poses problems in applications for managing
the Secure/Strong parts of the application and the Unsecure/Weak parts of the
application. In Turbine, the Action and Screen components make managing this process
quite simple. Assume the only Velocity Template allowed to be viewed without being
logged in is the actual Login.vm template. As this is the only Screen that
needs to be Unsecure/Weak we can manage this via the parent of Login Screen.
</p>



<div class="source">
<pre>
package com.mycompany.modules.screens;

//parent which allows Users to view the screen
public class WeakScreen extends VelocityScreen
{

    //nothing to check that the User
    //can view this screen
    protected void doBuildTemplate( RunData data, Context context )
        throws Exception
    {
        //call to Super
        super.doBuildTemplate(data, context);
    }
}

package com.mycompany.modules.screens;

//the java component of the Login Velocity Template
public class Login extends WeakScreen
{

    //nothing to check that the User
    //can view this screen
    protected void doBuildTemplate( RunData data, Context context )
        throws Exception
    {
        context.put(&quot;date&quot;,new Date());

        //call to Super
        super.doBuildTemplate(data, context);
    }
}
</pre></div>


<p>
Note that there is nothing in that method which checks that the User has logged in.
On the other hand, for the Secure or Strong Actions and Screens we would want a
check to ensure that the User has logged in.
</p>


<div class="source">
<pre>
package com.mycompany.modules.screens;

//Strong screen which checks for login
public class StrongScreen extends VelocityScreen
{
    //check that User has Logged in before bothering
    //to add anything to the context.
    protected void doBuildTemplate( RunData data )
        throws Exception
    {
        if (data.getUser().hasLoggedIn())
        {
            doBuildTemplate( data, TurbineVelocity.getContext( data ) );
        }
        else
        {
            //send the User to the Login Template
            data.setMessage(&quot;Please Login first!&quot;);
            setTemplate(data,&quot;Login.vm&quot;);
        }
    }
}

package com.mycompany.modules.screens;

//as an example use the Invoices again
public class Invoice extends StrongScreen
{
    //can view this screen
    protected void doBuildTemplate( RunData data, Context context )
        throws Exception
    {
        context.put(&quot;invoice&quot;,new Invoice());

        //call to Super
        super.doBuildTemplate(data, context);
    }
}
</pre></div>


<p>
In the latter example, before the Screen populates the Context it will check for the
User being logged in by the doBuildTemplate(data) method in the parent. If the test
fails, the context isnt created for the Invoice screen. Another way to manage this
is to seperate the screens into two packages, com.mycompany.modules.screens.unsecure
and com.mycompany.modules.screens.secure and have a Default.java Screen in each
of the packages mimicing the above approaches.
</p>

</div>



      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
              Copyright &#169;                    2000-2015
                        <a href="http://www.apache.org/">The Apache Software Foundation</a>.
            All Rights Reserved.      
                    
                  </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>