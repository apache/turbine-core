<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html><head><title>Turbine - Security Howto</title><style type="text/css" media="all">
          @import url("../style/maven-base.css");
          
          @import url("../style/maven-theme.css");</style><link rel="stylesheet" href="../style/print.css" type="text/css" media="print"></link><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"></meta><meta name="author" content="Cameron Riley"></meta><meta name="email" content="criley@ekmail.com"></meta></head><body class="composite"><div id="banner"><a href="http://turbine.apache.org/" id="organizationLogo"><img alt="Apache Software Foundation" src="../images/turbine-project.png"></img></a><a href="http://turbine.apache.org/turbine/turbine-2.3.3/index.html" id="projectLogo"><img alt="turbine-2" src="../images/logo.gif"></img></a><div class="clear"><hr></hr></div></div><div id="breadcrumbs"><div class="xleft">Last published: 21 November 2008
                <span class="separator">|</span> Doc for  2.3.3
                </div><div class="xright">
        
        <a href="http://turbine.apache.org/">Turbine Home</a>
      
        
          
            <span class="separator">|</span>
          
        
        <a href="http://turbine.apache.org/fulcrum/">Fulcrum</a>
      
        
          
            <span class="separator">|</span>
          
        
        <a href="http://turbine.apache.org/meta/">META</a>
      </div><div class="clear"><hr></hr></div></div><div id="leftColumn"><div id="navcolumn"><div id="menuGeneral_Information"><h5>General Information</h5><ul><li class="none"><a href="../index.html">Overview</a></li><li class="none"><a href="../features.html">Features</a></li><li class="none"><a href="../fsd.html">Specification</a></li><li class="none"><a href="../getting-started.html">Getting Started</a></li></ul></div><div id="menuDocumentation"><h5>Documentation</h5><ul><li class="none"><a href="../changes-report.html">Changes</a></li><li class="none"><a href="../turbine-schema.html">Core DB Schema</a></li><li class="collapsed"><a href="../services/index.html">Services</a></li><li class="expanded"><a href="../howto/index.html">Howtos</a><ul><li class="none"><a href="../howto/action-event-howto.html">Action Events Howto</a></li><li class="none"><a href="../howto/configuration-howto.html">Configuration Howto</a></li><li class="none"><a href="../howto/extend-user-howto.html">Extend User Howto</a></li><li class="none"><a href="../howto/hibernate-howto.html">Hibernate OM Howto</a></li><li class="none"><a href="../howto/intake-howto.html">Intake Howto</a></li><li class="none"><a href="../howto/jboss-howto.html">JBoss Howto</a></li><li class="none"><a href="../howto/jsp-howto.html">JSP Howto</a></li><li class="none"><a href="../howto/migrate-from-2_1-howto.html">Migrating 2.1 to 2.2</a></li><li class="none"><a href="../howto/migrate-from-2_2-howto.html">Migrating 2.2 to 2.3</a></li><li class="none"><a href="../howto/pullmodel-howto.html">Pull Model Howto</a></li><li class="none"><a href="../howto/python-howto.html">Python Howto</a></li><li class="none"><strong><a href="../howto/security-howto.html">Security Howto</a></strong></li><li class="none"><a href="../howto/services-howto.html">Services Howto</a></li><li class="none"><a href="../howto/sql-howto.html">How to build the SQL files</a></li><li class="none"><a href="../howto/url-rewriting-howto.html">URL rewriting Howto</a></li><li class="none"><a href="../howto/context-howto.html">Velocity Context Howto</a></li><li class="none"><a href="../howto/velocity-site-howto.html">Velocity Site Howto</a></li><li class="none"><a href="../howto/velocityonlylayout-howto.html">VelocityOnlyLayout Howto</a></li><li class="none"><a href="http://wiki.apache.org/turbine/Turbine2" class="externalLink" title="External Link">Wiki Howtos</a></li></ul></li><li class="none"><a href="../apidocs/index.html">JavaDocs</a></li></ul></div><div id="menuDevelopment"><h5>Development</h5><ul><li class="none"><a href="../proposals.html">Proposals</a></li><li class="none"><a href="../how-to-help.html">How To Help</a></li><li class="none"><a href="../todo.html">Todo</a></li></ul></div><div id="menuProject_Documentation"><h5>Project Documentation</h5><ul><li class="none"><a href="../index.html">About</a></li><li class="collapsed"><a href="../project-info.html">Project Info</a></li><li class="collapsed"><a href="../maven-reports.html">Project Reports</a></li><li class="none"><a href="../development-process.html">Development Process</a></li></ul></div><div id="legend"><h5>Legend</h5><ul><li class="externalLink">External Link</li><li class="newWindow">Opens in a new window</li></ul></div><a href="http://maven.apache.org/" title="Built by Maven" id="poweredBy"><img alt="Built by Maven" src="../images/logos/mavenlogo_builtby_w.png"></img></a></div></div><div id="bodyColumn"><div class="contentBox"><div class="section"><a name="Turbine_Security"></a><h2>Turbine Security</h2>

<p>
The Turbine Security includes a <a href="../services/security-service.html">Security Service</a>
as well as Actions and Screens that can be extended in the Templating Services.
</p>

</div><div class="section"><a name="Users__Groups__Roles_and_Permissions"></a><h2>Users, Groups, Roles and Permissions</h2>

<p>
The default Relational Database schema that Turbine uses for the database security
service, and which the TDK is generated with upon initialisation, includes the
data structure for the managing of permissions.
The default or core schema can be viewed at;
</p>

<p>
<ul><a href="../turbine-schema.html">Turbine Core Schema</a></ul>
</p>

<p>
The main tables are TURBINE_GROUP, TURBINE_USER, TURBINE_ROLE and TURBINE_PERMISSION.
The Permissions are the individual actions a user is allowed to take in the system.
The Role is a container for the Permissions, in other words a Role can be made of
many Permissions. User is an account that is interaction with the System and the Group
is a something that a User would want to do something in. In the Turbine mailing lists
it has often been described in the same way as a project. In a project you have fulfill
a role, however a User doesn't "belong" to a project they merely have a role in that
project ( or group ). In this manner too a User can have many Roles within the one
Group. For instance a User may have the Role Developer in the Group, but may also have
the Role of Administrator as well. While initially confusing at first, as there
are no group-user or role-user containers, it is a flexible system and strong system.
</p>

</div><div class="section"><a name="Access_Control_Lists"></a><h2>Access Control Lists</h2>

<p>
A User's interaction through the system is controlled by the Permissions they are
able to partake in. The AccessControlLists manage this information and present it via
RunData and User Interfaces to the application. The RunData interface through the
getACL() method presents the AccessControlList Object.
</p>


    <div class="source"><pre>
//get the AccessControlList Object
//from RunData
AccessControlList acl = data.getACL();

//check if the User ( from the http request )
//has permission to view the invoices
if( acl.hasPermission("viewinvoice") )
{
    data.setMessage("You have permission to view the invoices.");
    setTemplate(data, "Invoice.vm");
}
else
{
    data.setMessage("You do not have Permission to view the Invoices");
    setTemplate(data, "UnauthorizedRequest.vm");
}
</pre></div>
  

<p>
This will check if the User has permission to view this in the Global Group which
is useful for managing Anonymous Users as well as logged in Users across your
application. If however you need stronger security, such as only allowing users that
have logged in, and have a Role in a specific Group, the Permission will need to be
matched to the Group and User. As an example, assume one of your groups is "Accounting"
and the Invoice information is only to be viewed by Users that have a Role in Accounting
as well as the Permission "viewinvoice", the above method would be re-written;
</p>


    <div class="source"><pre>
//get the User from RunData
User user = data.getUser();

//get the AccessControlList Object
//from RunData
AccessControlList acl = data.getACL();

//check if the User has logged in,
//has a role in the group and
//has permission to view the invoices
if( user.hasLoggedIn() &amp;&amp;
    acl.hasPermission("viewinvoice", "Accounting") )
{
   data.setMessage("You have permission to view the invoices.");
   setTemplate(data, "Invoice.vm");
}
else
{
   data.setMessage("You do not have Permission to view the Invoices");
   setTemplate(data, "UnauthorizedRequest.vm");
}
</pre></div>
  

<p>
If instead the Permission could be across any of the Roles the User has, the
method acl.hasPermission(String permission, GroupSet groups), can be used. As
always check the Javadocs for more detail.
</p>

</div><div class="section"><a name="Templates_and_Logging_In"></a><h2>Templates and Logging In</h2>

<p>
Managing Anonymous Users and Logged In Users poses problems in applications for managing
the Secure/Strong parts of the application and the Unsecure/Weak parts of the
application. In Turbine, the Action and Screen components make managing this process
quite simple. Assume the only Velocity Template allowed to be viewed without being
logged in is the actual Login.vm template. As this is the only Screen that
needs to be Unsecure/Weak we can manage this via the parent of Login Screen.
</p>



    <div class="source"><pre>
package com.mycompany.modules.screens;

//parent which allows Users to view the screen
public class WeakScreen extends VelocityScreen
{

    //nothing to check that the User
    //can view this screen
    protected void doBuildTemplate( RunData data, Context context )
        throws Exception
    {
        //call to Super
        super.doBuildTemplate(data, context);
    }
}

package com.mycompany.modules.screens;

//the java component of the Login Velocity Template
public class Login extends WeakScreen
{

    //nothing to check that the User
    //can view this screen
    protected void doBuildTemplate( RunData data, Context context )
        throws Exception
    {
        context.put("date",new Date());

        //call to Super
        super.doBuildTemplate(data, context);
    }
}
</pre></div>
  

<p>
Note that there is nothing in that method which checks that the User has logged in.
On the other hand, for the Secure or Strong Actions and Screens we would want a
check to ensure that the User has logged in.
</p>


    <div class="source"><pre>
package com.mycompany.modules.screens;

//Strong screen which checks for login
public class StrongScreen extends VelocityScreen
{
    //check that User has Logged in before bothering
    //to add anything to the context.
    protected void doBuildTemplate( RunData data )
        throws Exception
    {
        if (data.getUser().hasLoggedIn())
        {
            doBuildTemplate( data, TurbineVelocity.getContext( data ) );
        }
        else
        {
            //send the User to the Login Template
            data.setMessage("Please Login first!");
            setTemplate(data,"Login.vm");
        }
    }
}

package com.mycompany.modules.screens;

//as an example use the Invoices again
public class Invoice extends StrongScreen
{
    //can view this screen
    protected void doBuildTemplate( RunData data, Context context )
        throws Exception
    {
        context.put("invoice",new Invoice());

        //call to Super
        super.doBuildTemplate(data, context);
    }
}
</pre></div>
  

<p>
In the latter example, before the Screen populates the Context it will check for the
User being logged in by the doBuildTemplate(data) method in the parent. If the test
fails, the context isn't created for the Invoice screen. Another way to manage this
is to seperate the screens into two packages, com.mycompany.modules.screens.unsecure
and com.mycompany.modules.screens.secure and have a Default.java Screen in each
of the packages mimicking the above approaches.
</p>

</div></div></div><div class="clear"><hr></hr></div><div id="footer"><div class="xright">© 2000-2008, Apache Software Foundation</div><div class="clear"><hr></hr></div></div></body></html>