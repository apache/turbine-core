<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.11.1 from xdocs/howto\security-howto.xml at 26 January 2024
 | Rendered using Apache Maven Fluido Skin 1.9
-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 1.11.1" />
    <title>Apache Turbine &#x2013; Security Howto</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.9.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />
    <script src="../js/apache-maven-fluido-1.9.min.js"></script>
<link rel="icon" type="image/png" sizes="48x48" href="./images/favicon.ico"> 
      <link rel="icon" type="image/png" sizes="48x48" href="../images/favicon.ico"> 
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
  </head>
  <body class="topBarDisabled">
    <a href="https://github.com/apache/turbine-core">
      <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 10000;"
        src="https://s3.amazonaws.com/github/ribbons/forkme_right_orange_ff7600.png"
        alt="Fork me on GitHub">
    </a>
    <div class="container-fluid">
      <header>
        <div id="banner">
          <div class="pull-left"><a href="../../" id="bannerLeft" title="Apache Turbine"><img src="../images/turbine-project-apache-separate.png"  alt="Apache Turbine"/></a></div>
          <div class="pull-right"><div id="bannerRight"><img src="../images/logo.gif"  alt=""/></div>
</div>
          <div class="clear"><hr/></div>
        </div>

        <div id="breadcrumbs">
          <ul class="breadcrumb">
        <li id="publishDate">Last Published: 26 January 2024<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 6.0</li>
      <li class="pull-right"><span class="divider">|</span>
<a href="https://turbine.apache.org/fulcrum/" class="externalLink" title="Fulcrum">Fulcrum</a></li>
      <li class="pull-right"><span class="divider">|</span>
<a href="https://turbine.apache.org/" class="externalLink" title="Turbine">Turbine</a></li>
      <li class="pull-right"><a href="https://www.apache.org" class="externalLink" title="Apache">Apache</a></li>
          </ul>
        </div>
      </header>
      <div class="row-fluid">
        <header id="leftColumn" class="span2">
          <nav class="well sidebar-nav">
  <ul class="nav nav-list">
   <li class="nav-header">General Information</li>
    <li><a href="../index.html" title="Overview"><span class="none"></span>Overview</a></li>
    <li><a href="../features.html" title="Features"><span class="none"></span>Features</a></li>
    <li><a href="../fsd.html" title="Specification"><span class="none"></span>Specification</a></li>
    <li><a href="../getting-started.html" title="Getting Started"><span class="none"></span>Getting Started</a></li>
    <li><a href="../how-to-build.html" title="Howto Build Turbine"><span class="none"></span>Howto Build Turbine</a></li>
    <li><a href="../changes-report.html" title="Changes"><span class="none"></span>Changes</a></li>
   <li class="nav-header">Documentation</li>
    <li><a href="../services/index.html" title="Services"><span class="icon-chevron-right"></span>Services</a></li>
    <li><a href="../howto/index.html" title="Howtos"><span class="icon-chevron-down"></span>Howtos</a>
     <ul class="nav nav-list">
      <li><a href="../howto/action-event-howto.html" title="Action Events Howto"><span class="none"></span>Action Events Howto</a></li>
      <li><a href="../howto/annotations.html" title="Annotations Howto"><span class="none"></span>Annotations Howto</a></li>
      <li><a href="../howto/configuration-howto.html" title="Configuration Howto"><span class="none"></span>Configuration Howto</a></li>
      <li><a href="../howto/extend-user-howto.html" title="Extend User Howto"><span class="none"></span>Extend User Howto</a></li>
      <li><a href="../howto/hibernate-howto.html" title="Hibernate OM Howto"><span class="none"></span>Hibernate OM Howto</a></li>
      <li><a href="../howto/intake-howto.html" title="Intake Howto"><span class="none"></span>Intake Howto</a></li>
      <li><a href="../howto/jsp-howto.html" title="JSP Howto"><span class="none"></span>JSP Howto</a></li>
      <li><a href="../howto/migrate-from-2_1-howto.html" title="Migrating from 2.1 to 2.2"><span class="none"></span>Migrating from 2.1 to 2.2</a></li>
      <li><a href="../howto/migrate-from-2_2-howto.html" title="Migrating from 2.2 to 2.3"><span class="none"></span>Migrating from 2.2 to 2.3</a></li>
      <li><a href="../howto/migrate-from-2_3-howto.html" title="Migrating from 2.3 to 4.0"><span class="none"></span>Migrating from 2.3 to 4.0</a></li>
      <li><a href="../howto/migrate-from-4_0-howto.html" title="Migrating from 4.0 to 5.0"><span class="none"></span>Migrating from 4.0 to 5.0</a></li>
      <li><a href="../howto/pullmodel-howto.html" title="Pull Model Howto"><span class="none"></span>Pull Model Howto</a></li>
      <li><a href="../howto/python-howto.html" title="Python Howto"><span class="none"></span>Python Howto</a></li>
      <li class="active"><a href="#"><span class="none"></span>Security Howto</a></li>
      <li><a href="../howto/services-howto.html" title="Services Howto"><span class="none"></span>Services Howto</a></li>
      <li><a href="../howto/url-mapper-howto.html" title="URL Mapper Howto"><span class="none"></span>URL Mapper Howto</a></li>
      <li><a href="../howto/url-rewriting-howto.html" title="URL Rewriting Howto"><span class="none"></span>URL Rewriting Howto</a></li>
      <li><a href="../howto/context-howto.html" title="Velocity Context Howto"><span class="none"></span>Velocity Context Howto</a></li>
      <li><a href="../howto/velocity-site-howto.html" title="Velocity Site Howto"><span class="none"></span>Velocity Site Howto</a></li>
      <li><a href="../howto/velocityonlylayout-howto.html" title="VelocityOnlyLayout Howto"><span class="none"></span>VelocityOnlyLayout Howto</a></li>
     </ul></li>
    <li><a href="https://cwiki.apache.org/confluence/display/TURBINE" class="externalLink" title="Wiki"><span class="none"></span>Wiki</a></li>
    <li><a href="../apidocs/index.html" title="JavaDocs"><span class="none"></span>JavaDocs</a></li>
   <li class="nav-header">Development</li>
    <li><a href="../proposals.html" title="Proposals"><span class="none"></span>Proposals</a></li>
    <li><a href="../how-to-help.html" title="How To Help"><span class="none"></span>How To Help</a></li>
    <li><a href="../todo.html" title="Todo"><span class="none"></span>Todo</a></li>
   <li class="nav-header">Project Documentation</li>
    <li><a href="../project-info.html" title="Project Information"><span class="icon-chevron-right"></span>Project Information</a></li>
    <li><a href="../project-reports.html" title="Project Reports"><span class="icon-chevron-right"></span>Project Reports</a></li>
   <li class="nav-header">Apache</li>
    <li><a href="https://www.apache.org/" class="externalLink" title="Apache Website"><span class="none"></span>Apache Website</a></li>
    <li><a href="https://www.apache.org/licenses/" class="externalLink" title="License"><span class="none"></span>License</a></li>
    <li><a href="https://www.apache.org/foundation/how-it-works.html" class="externalLink" title="How the ASF works"><span class="none"></span>How the ASF works</a></li>
    <li><a href="https://www.apache.org/foundation/sponsorship.html" class="externalLink" title="Sponsorship"><span class="none"></span>Sponsorship</a></li>
    <li><a href="https://www.apache.org/foundation/thanks.html" class="externalLink" title="Thanks"><span class="none"></span>Thanks</a></li>
    <li><a href="https://www.apache.org/security/" class="externalLink" title="Security"><span class="none"></span>Security</a></li>
  </ul>
          </nav>
          <div class="well sidebar-nav">
<form id="search-form" action="https://www.google.com/search" method="get" >
  <input value="http://turbine.apache.org/turbine-core" name="sitesearch" type="hidden"/>
  <input class="search-query" name="q" id="query" type="text" />
</form>
<script>asyncJs( 'https://cse.google.com/brand?form=search-form' )</script>
            <hr />
            <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
<a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="../images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </header>
        <main id="bodyColumn"  class="span10" >


 

<section>
<h2><a name="Turbine_Security"></a>Turbine Security</h2>


<p>
The Turbine Security includes a <a href="../services/security-service.html">Security Service</a>
as well as Actions and Screens that can be extended in the Templating Services.
</p>

</section>





<section>
<h2><a name="Users.2C_Groups.2C_Roles_and_Permissions"></a>Users, Groups, Roles and Permissions</h2>


<p>
The default Relational Database schema that Turbine uses for the database security
service includes the
data structure for the managing of permissions.
The default or core schema can be viewed at;
</p>


<p>
</p>
<ul><a href="../turbine-schema.html">Turbine Core Schema</a></ul>



<p>
The main tables are TURBINE_GROUP, TURBINE_USER, TURBINE_ROLE and TURBINE_PERMISSION.
The Permissions are the individual actions a user is allowed to take in the system.
The Role is a container for the Permissions, in other words a Role can be made of
many Permissions. User is an account that is interaction with the System and the Group
is a something that a User would want to do something in. In the Turbine mailing lists
it has often been described in the same way as a project. In a project you have fulfill
a role, however a User doesnt &quot;belong&quot; to a project they merely have a role in that
project ( or group ). In this manner too a User can have many Roles within the one
Group. For instance a User may have the Role Developer in the Group, but may also have
the Role of Administrator as well. While initially confusing at first, as there
are no group-user or role-user containers, it is a flexible system and strong system.
</p>

</section>


<section>
<h2><a name="Access_Control_Lists"></a>Access Control Lists</h2>


<p>
A User's interaction through the system is controlled by the Permissions they are
able to partake in. The AccessControlLists manage this information and present it via
RunData and User Interfaces to the application. The RunData interface through the
getACL() method presents the AccessControlList Object.
</p>


<div class="source"><pre class="prettyprint">
//get the AccessControlList Object
//from RunData
AccessControlList acl = data.getACL();

//check if the User ( from the http request )
//has permission to view the invoices
if( acl.hasPermission(&quot;viewinvoice&quot;) )
{
    data.setMessage(&quot;You have permission to view the invoices.&quot;);
    setTemplate(data, &quot;Invoice.vm&quot;);
}
else
{
    data.setMessage(&quot;You do not have Permission to view the Invoices&quot;);
    setTemplate(data, &quot;UnauthorizedRequest.vm&quot;);
}
</pre></div>


<p>
This will check if the User has permission to view this in the Global Group which
is useful for managing Anonymous Users as well as logged in Users across your
application. If however you need stronger security, such as only allowing users that
have logged in, and have a Role in a specific Group, the Permission will need to be
matched to the Group and User. As an example, assume one of your groups is &quot;Accounting&quot;
and the Invoice information is only to be viewed by Usersthat have a Role in Accounting
as well as the Permission &quot;viewinvoice&quot;, the above method would be re-written;
</p>


<div class="source"><pre class="prettyprint">
//get the User from RunData
User user = data.getUser();

//get the AccessControlList Object
//from RunData
AccessControlList acl = data.getACL();

//check if the User has logged in,
//has a role in the group and
//has permission to view the invoices
if( user.hasLoggedIn() &amp;&amp;
    acl.hasPermission(&quot;viewinvoice&quot;, &quot;Accounting&quot;) )
{
   data.setMessage(&quot;You have permission to view the invoices.&quot;);
   setTemplate(data, &quot;Invoice.vm&quot;);
}
else
{
   data.setMessage(&quot;You do not have Permission to view the Invoices&quot;);
   setTemplate(data, &quot;UnauthorizedRequest.vm&quot;);
}
</pre></div>


<p>
If instead the Permission could be across any of the Roles the User has, the
method acl.hasPermission(String permission, GroupSet groups), can be used. As
always check the Javadocs for more detail.
</p>

</section>

<section>
<h2><a name="Templates_and_Logging_In"></a>Templates and Logging In</h2>


<p>
Managing Anonymous Users and Logged In Users poses problems in applications for managing
the Secure/Strong parts of the application and the Unsecure/Weak parts of the
application. In Turbine, the Action and Screen components make managing this process
quite simple. Assume the only Velocity Template allowed to be viewed without being
logged in is the actual Login.vm template. As this is the only Screen that
needs to be Unsecure/Weak we can manage this via the parent of Login Screen.
</p>



<div class="source"><pre class="prettyprint">
package com.mycompany.modules.screens;

//parent which allows Users to view the screen
public class WeakScreen extends VelocityScreen
{

    //nothing to check that the User
    //can view this screen
    protected void doBuildTemplate( RunData data, Context context )
        throws Exception
    {
        //call to Super
        super.doBuildTemplate(data, context);
    }
}

package com.mycompany.modules.screens;

//the java component of the Login Velocity Template
public class Login extends WeakScreen
{

    //nothing to check that the User
    //can view this screen
    protected void doBuildTemplate( RunData data, Context context )
        throws Exception
    {
        context.put(&quot;date&quot;,new Date());

        //call to Super
        super.doBuildTemplate(data, context);
    }
}
</pre></div>


<p>
Note that there is nothing in that method which checks that the User has logged in.
On the other hand, for the Secure or Strong Actions and Screens we would want a
check to ensure that the User has logged in.
</p>


<div class="source"><pre class="prettyprint">
package com.mycompany.modules.screens;

//Strong screen which checks for login
public class StrongScreen extends VelocityScreen
{
    //check that User has Logged in before bothering
    //to add anything to the context.
    protected void doBuildTemplate( RunData data )
        throws Exception
    {
        if (data.getUser().hasLoggedIn())
        {
            doBuildTemplate( data, TurbineVelocity.getContext( data ) );
        }
        else
        {
            //send the User to the Login Template
            data.setMessage(&quot;Please Login first!&quot;);
            setTemplate(data,&quot;Login.vm&quot;);
        }
    }
}

package com.mycompany.modules.screens;

//as an example use the Invoices again
public class Invoice extends StrongScreen
{
    //can view this screen
    protected void doBuildTemplate( RunData data, Context context )
        throws Exception
    {
        context.put(&quot;invoice&quot;,new Invoice());

        //call to Super
        super.doBuildTemplate(data, context);
    }
}
</pre></div>


<p>
In the latter example, before the Screen populates the Context it will check for the
User being logged in by the doBuildTemplate(data) method in the parent. If the test
fails, the context isnt created for the Invoice screen. Another way to manage this
is to seperate the screens into two packages, com.mycompany.modules.screens.unsecure
and com.mycompany.modules.screens.secure and have a Default.java Screen in each
of the packages mimicing the above approaches.
</p>

</section>



        </main>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>&#169;      2000&#x2013;2024
<a href="https://www.apache.org/">The Apache Software Foundation</a>
</p>
        </div>
      </div>
    </footer>
  </body>
</html>
