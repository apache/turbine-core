<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html><head><title>Turbine - Migrating from 2.2 to 2.3</title><style type="text/css" media="all">
          @import url("../style/maven-base.css");
          
          @import url("../style/maven-theme.css");</style><link rel="stylesheet" href="../style/print.css" type="text/css" media="print"></link><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"></meta><meta name="author" content="Eric Pugh"></meta><meta name="email" content="epugh@upstate.com"></meta><meta name="author" content="Chris Chew"></meta><meta name="email" content="chris@fenetics.com"></meta><meta name="author" content="Scott Eade"></meta><meta name="email" content="seade@backstagetech.com.au"></meta></head><body class="composite"><div id="banner"><a href="http://turbine.apache.org/" id="organizationLogo"><img alt="Apache Software Foundation" src="../images/turbine-project.png"></img></a><a href="http://turbine.apache.org/turbine/turbine-2.3.3/index.html" id="projectLogo"><img alt="turbine-2" src="../images/logo.gif"></img></a><div class="clear"><hr></hr></div></div><div id="breadcrumbs"><div class="xleft">Last published: 21 November 2008
                <span class="separator">|</span> Doc for  2.3.3
                </div><div class="xright">
        
        <a href="http://turbine.apache.org/">Turbine Home</a>
      
        
          
            <span class="separator">|</span>
          
        
        <a href="http://turbine.apache.org/fulcrum/">Fulcrum</a>
      
        
          
            <span class="separator">|</span>
          
        
        <a href="http://turbine.apache.org/meta/">META</a>
      </div><div class="clear"><hr></hr></div></div><div id="leftColumn"><div id="navcolumn"><div id="menuGeneral_Information"><h5>General Information</h5><ul><li class="none"><a href="../index.html">Overview</a></li><li class="none"><a href="../features.html">Features</a></li><li class="none"><a href="../fsd.html">Specification</a></li><li class="none"><a href="../getting-started.html">Getting Started</a></li></ul></div><div id="menuDocumentation"><h5>Documentation</h5><ul><li class="none"><a href="../changes-report.html">Changes</a></li><li class="none"><a href="../turbine-schema.html">Core DB Schema</a></li><li class="collapsed"><a href="../services/index.html">Services</a></li><li class="expanded"><a href="../howto/index.html">Howtos</a><ul><li class="none"><a href="../howto/action-event-howto.html">Action Events Howto</a></li><li class="none"><a href="../howto/configuration-howto.html">Configuration Howto</a></li><li class="none"><a href="../howto/extend-user-howto.html">Extend User Howto</a></li><li class="none"><a href="../howto/hibernate-howto.html">Hibernate OM Howto</a></li><li class="none"><a href="../howto/intake-howto.html">Intake Howto</a></li><li class="none"><a href="../howto/jboss-howto.html">JBoss Howto</a></li><li class="none"><a href="../howto/jsp-howto.html">JSP Howto</a></li><li class="none"><a href="../howto/migrate-from-2_1-howto.html">Migrating 2.1 to 2.2</a></li><li class="none"><strong><a href="../howto/migrate-from-2_2-howto.html">Migrating 2.2 to 2.3</a></strong></li><li class="none"><a href="../howto/pullmodel-howto.html">Pull Model Howto</a></li><li class="none"><a href="../howto/python-howto.html">Python Howto</a></li><li class="none"><a href="../howto/security-howto.html">Security Howto</a></li><li class="none"><a href="../howto/services-howto.html">Services Howto</a></li><li class="none"><a href="../howto/sql-howto.html">How to build the SQL files</a></li><li class="none"><a href="../howto/url-rewriting-howto.html">URL rewriting Howto</a></li><li class="none"><a href="../howto/context-howto.html">Velocity Context Howto</a></li><li class="none"><a href="../howto/velocity-site-howto.html">Velocity Site Howto</a></li><li class="none"><a href="../howto/velocityonlylayout-howto.html">VelocityOnlyLayout Howto</a></li><li class="none"><a href="http://wiki.apache.org/turbine/Turbine2" class="externalLink" title="External Link">Wiki Howtos</a></li></ul></li><li class="none"><a href="../apidocs/index.html">JavaDocs</a></li></ul></div><div id="menuDevelopment"><h5>Development</h5><ul><li class="none"><a href="../proposals.html">Proposals</a></li><li class="none"><a href="../how-to-help.html">How To Help</a></li><li class="none"><a href="../todo.html">Todo</a></li></ul></div><div id="menuProject_Documentation"><h5>Project Documentation</h5><ul><li class="none"><a href="../index.html">About</a></li><li class="collapsed"><a href="../project-info.html">Project Info</a></li><li class="collapsed"><a href="../maven-reports.html">Project Reports</a></li><li class="none"><a href="../development-process.html">Development Process</a></li></ul></div><div id="legend"><h5>Legend</h5><ul><li class="externalLink">External Link</li><li class="newWindow">Opens in a new window</li></ul></div><a href="http://maven.apache.org/" title="Built by Maven" id="poweredBy"><img alt="Built by Maven" src="../images/logos/mavenlogo_builtby_w.png"></img></a></div></div><div id="bodyColumn"><div class="contentBox"><div class="section"><a name="Introduction"></a><h2>Introduction</h2>
<p>
    This document describes the basic steps needed to migrate an
    application written for Turbine 2.2 to Turbine 2.3.
</p>
<p>
    You may find that migrating to 2.3 is not all that difficult -
    it should certainly be less trouble than migrating from 2.1 to
    2.2. Most of the pain in figuring out this migration process
    has been documented in the mailing list archives, but is
    summarized here for your convenience.
</p>
</div><div class="section"><a name="Deprecated_And_Removed_Services"></a><h2>Deprecated And Removed Services</h2>
<p>
    In 2.3, many services have been deprecated or removed wholly.
    Below are the changes I made to get my 2.2 app to work under 2.3.
</p>
<p>
    Remove from tr.props ( and any properties that start with services.XXX):
</p>

    <div class="source"><pre>

 services.PoolBrokerService.classname=org.apache.turbine.services.db.TurbinePoolBrokerService
 services.MapBrokerService.classname=org.apache.turbine.services.db.TurbineMapBrokerService
 services.ResourceService.classname=org.apache.turbine.services.resources.TurbineResourceService
 services.LoggingService.classname=org.apache.turbine.services.logging.TurbineLoggingService

</pre></div>
  
<p>
    Note: Removing LoggingService removes all logging stuff from
    TurbineResources.properties as well! Now you use a Log4j.properties:
    WEB-INF\conf\Log4j.properties. You need at least an empty file,
    otherwise log4j complains, but something like this will be better:
</p>

    <div class="source"><pre>

# -------------------------------------------------------------------
# Log4j.properties
# -------------------------------------------------------------------

# This first category is required and the category
# must be named 'default'. This is used for all logging
# where an explicit category is not specified.

log4j.category.default = INFO, default
log4j.category.org.apache.turbine.services.pull.tools.UITool = DEBUG, default

log4j.appender.default = org.apache.log4j.RollingFileAppender
log4j.appender.default.file = logs/turbine.log
log4j.appender.default.MaxFileSize = 1024KB
log4j.appender.default.MaxBackupIndex = 5
log4j.appender.default.append = true
log4j.appender.default.layout = org.apache.log4j.PatternLayout
log4j.appender.default.layout.conversionPattern = %d %-5p [%-10t] %c{2} - %m%n

log4j.appender.email = org.apache.log4j.net.SMTPAppender
log4j.appender.email.BufferSize = 512
log4j.appender.email.From = @your-from-address@
log4j.appender.email.SMTPHost = @your-mail-host@
log4j.appender.email.Subject = Turbine Error Report
log4j.appender.email.To = @your-to-address@
log4j.appender.email.layout = org.apache.log4j.PatternLayout
log4j.appender.email.layout.conversionPattern = %d %-5p [%-10t] %c{2} - %m%n

# This category is used in the BasePeer class. All
# SQL generated will be logged if the category
# priority is set to DEBUG

log4j.category.org.apache.torque.util.BasePeer = DEBUG, org.apache.torque.util.BasePeer
log4j.additivity.org.apache.torque.util.BasePeer = false
log4j.appender.org.apache.torque.util.BasePeer = org.apache.log4j.RollingFileAppender
log4j.appender.org.apache.torque.util.BasePeer.file = logs/sql.log
log4j.appender.org.apache.torque.util.BasePeer.MaxFileSize = 1024KB
log4j.appender.org.apache.torque.util.BasePeer.MaxBackupIndex = 3
log4j.appender.org.apache.torque.util.BasePeer.append = true
log4j.appender.org.apache.torque.util.BasePeer.layout = org.apache.log4j.PatternLayout
log4j.appender.org.apache.torque.util.BasePeer.layout.conversionPattern = %d %-5p [%-10t] %c{1} - %m%n

log4j.category.@your-package@.modules.scheduledjobs = DEBUG, scheduledjobs, email
log4j.additivity.@your-package@.modules.scheduledjobs = false
log4j.appender.scheduledjobs = org.apache.log4j.RollingFileAppender
log4j.appender.scheduledjobs.file = logs/batch.log
log4j.appender.scheduledjobs.MaxFileSize = 256KB
log4j.appender.scheduledjobs.MaxBackupIndex = 5
log4j.appender.scheduledjobs.append = true
log4j.appender.scheduledjobs.layout = org.apache.log4j.PatternLayout
log4j.appender.scheduledjobs.layout.conversionPattern = %d %-5p [%-10t] %c{1} - %m%n

</pre></div>
  

</div><div class="section"><a name="Commons-logging_Replaces_Built-in_Logging"></a><h2>Commons-logging Replaces Built-in Logging</h2>
<p>
    In 2.3, the built in logging has been deprecated in favor of using
    commons-logging. Therefore, where ever you have this import:
</p>

    <div class="source"><pre>

import org.apache.turbine.util.Log;

</pre></div>
  
<p>
	you will need to remove it and replace it with:
</p>

    <div class="source"><pre>

import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;

</pre></div>
  
<p>
	Also, instead of calling static methods of the old Log object:
	Log.debug("my message") you will need instead to do this:
</p>
	
    <div class="source"><pre>

 private static Log log = LogFactory.getLog(Audit.class);
 .
 .
 .
 log.debug("My message");

</pre></div>
  
<p>
	The advantage of this is that now in your logging messages, you will know
	what class the message is coming from, versus the old way where all you
	got was the message and you would have to embed the name of the action to
	know what was emitting the logging message! Also, this makes your
	underlying logging architecture pluggable. If you use jdk1.4, you can
	plug in the java logging, or use log4j.  See the example Log4j.properties
	file above to see a few of the possibilities.
</p>
</div><div class="section"><a name="Use_VelocityOnly_Layout"></a><h2>Use VelocityOnly Layout</h2>
<p>
    Change from VelocityECSLayout to VelocityOnly Layout - see:
	<a href="velocityonlylayout-howto.html">VelocityOnlyLayout Howto</a>.
</p>
</div><div class="section"><a name="New_Dependencies"></a><h2>New Dependencies</h2>
<p>
    In order to make the Turbine jar smaller, some things have been moved to
    commons. There are in fact a raft of new dependencies that you should
    ensure you use as part of your application - see:
    <a href="../dependencies.html">Dependencies</a>.
</p>
</div><div class="section"><a name="earlyInit_Parameter_For_Selected_Services"></a><h2>earlyInit Parameter For Selected Services</h2>
<p>
    In order to get some services to work under 2.3, it is necessary to set
    an earlyInit parameter in TurbineResources.properties:
</p>

    <div class="source"><pre>

services.PullService.earlyInit=true
services.SessionService.earlyInit=true

</pre></div>
  
<p>
	If your service is not being initialized as you would expect then try
	setting this flag for it.
</p>
</div><div class="section"><a name="New_Optional_URI_Handling_Tools"></a><h2>New Optional URI Handling Tools</h2>
<p>
	Under 2.3 there are new URI handling tools with a significant refactoring
	of how relative and absolute URL's are handled in Turbine. Briefly, the
	new tools avoid the confusion that arose previously from mixing tools
	with internal classes, providing uniform access to the various URI types
	in Turbine. <strong>These new tools are backwards-compatible with your old
	$link and $content tools, so you should not have to change any of your
	templates if you decide to use the new tools.</strong>
</p>
<p>
	To use the new tools, simply redefine the following pull tools in your
	TurbineResources.properties:
</p>
	
    <div class="source"><pre>

tool.request.link    = org.apache.turbine.services.pull.tools.TemplateLink
tool.request.content = org.apache.turbine.services.pull.tools.ContentTool

</pre></div>
  
<p>
	If you used some of the other tools for creating URL's, replace them with
    the tools above and look for the configuration settings
</p>
	
    <div class="source"><pre>

tool.link.want.relative = true
tool.content.want.relative = true

</pre></div>
  
<p>
    Using template links with slashes is no longer supported.
</p>
</div><div class="section"><a name="Ensure_you_refer_to_your_templates_correctly"></a><h2>Ensure you refer to your templates correctly</h2>
<p>
    Places where you might previously have got away with using forward slashes
    ("/") in your references to template names will need to be corrected (note
    that this does not apply to the Velocity #parse() and #include()
    statements which operate at a lower level). See:
    <a href="../services/template-service.html">Template Service</a>.
</p>
</div><div class="section"><a name="Update_to_the_latest_DTDs_for_Intake_and_Torque"></a><h2>Update to the latest DTDs for Intake and Torque</h2>
<p>
    Updating your Intake configuration xml file and your Torque schema files
    to use the most recent DTDs will ensure that the DTDResolver can be used
    when validating these files.  Deprecation warnings may be produced while
    these files are being processed - as with your application code you should
    aim to update these files so that no deprecation warnings are produced
    before the next Turbine release.
</p>
</div><div class="section"><a name="Extending_Turbine_User"></a><h2>Extending Turbine User</h2>
<p>
    Refer to <a href="../services/torque-security-service.html">Torque
    Security Service</a> for information on extending TurbineUser in Turbine
    2.3 - this is now much easier than it was in previous releases.  You
    may also want to refer to
    <a href="http://mail-archives.apache.org/eyebrowse/ReadMsg?listName=turbine-dev@jakarta.apache.org&amp;msgNo=15077" class="externalLink" title="External Link">
    this message from the mail archive</a> - the quoted text from Henning is
    great and Wei points to a couple of additional messages that may also
    prove useful.
</p>
<p>
    In the past you may have used a customised MapBuilder
    (database.maps.builder in TurbineResources.properties) as part of
    extending your user object - this is no longer required if you use the
    Torque Security Service.  In addition to this you need to ensure that
    you replace any references you may have made to the old security related
    peer classes in any Criteria with the new classes that Torque generates
    for you as referring to the old ones will result in an inconsistent
    database map such that your extended user attributes may not consistently
    be maintained.
</p>
</div><div class="section"><a name="Building_Torque_OM_Classes"></a><h2>Building Torque OM Classes</h2>
<p>
	You will need to use Maven b9 or above in order to build the Torque
	Security Service and even then you should install the latest available
	release of the <a href="http://db.apache.org/torque/releases/torque-3.1.1/maven-howto.html" class="externalLink" title="External Link">
	Torque generator</a> plugin.
</p>
</div><div class="section"><a name="Updates_to_this_document"></a><h2>Updates to this document</h2>
<p>
    This document is by no means complete or totally accurate. We welcome
    suggestions as to how it might be improved, particularly if you have
    just completed migrating an application by following this howto.
</p>
</div></div></div><div class="clear"><hr></hr></div><div id="footer"><div class="xright">© 2000-2008, Apache Software Foundation</div><div class="clear"><hr></hr></div></div></body></html>