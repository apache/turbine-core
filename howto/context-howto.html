<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Apache Maven Doxia Site Renderer 1.4 at 21 December 2015 -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Apache Turbine - 
    Context Howto</title>
    <style type="text/css" media="all">
      @import url("../css/maven-base.css");
      @import url("../css/maven-theme.css");
      @import url("../css/site.css");
    </style>
    <link rel="stylesheet" href="../css/print.css" type="text/css" media="print" />
    <meta name="Date-Revision-yyyymmdd" content="20151221" />
    <meta http-equiv="Content-Language" content="en" />
        
        </head>
  <body class="composite">
    <div id="banner">
                                      <a href="../../../" id="bannerLeft" title="Apache Turbine">
                                                <img src="../images/turbine-project.png" alt="Apache Turbine" />
                </a>
                          <div id="bannerRight">
                                                <img src="../images/logo.gif" alt="Apache Turbine" />
                </div>
            <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
            
                    
                <div class="xleft">
        <span id="publishDate">Last Published: 21 December 2015</span>
                  &nbsp;| <span id="projectVersion">Version: 4.0-M2</span>
                      </div>
            <div class="xright">                    <a href="http://www.apache.org" class="externalLink" title="Apache">Apache</a>
            |
                        <a href="../../../" title="Turbine">Turbine</a>
            |
                        <a href="../../../fulcrum/" title="Fulcrum">Fulcrum</a>
              
                    
      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
             
                    
                                <h5>General Information</h5>
                  <ul>
                  <li class="none">
                          <a href="../index.html" title="Overview">Overview</a>
            </li>
                  <li class="none">
                          <a href="../features.html" title="Features">Features</a>
            </li>
                  <li class="none">
                          <a href="../fsd.html" title="Specification">Specification</a>
            </li>
                  <li class="none">
                          <a href="../getting-started.html" title="Getting Started">Getting Started</a>
            </li>
                  <li class="none">
                          <a href="../how-to-build.html" title="Howto Build Turbine">Howto Build Turbine</a>
            </li>
                  <li class="none">
                          <a href="../changes-report.html" title="Changes">Changes</a>
            </li>
          </ul>
                       <h5>Documentation</h5>
                  <ul>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <li class="collapsed">
                          <a href="../services/index.html" title="Services">Services</a>
                  </li>
                                                                                                                                                                                                                                                                                                                                                                                                <li class="expanded">
                          <a href="../howto/index.html" title="Howtos">Howtos</a>
                    <ul>
                      <li class="none">
                          <a href="../howto/action-event-howto.html" title="Action Events Howto">Action Events Howto</a>
            </li>
                      <li class="none">
                          <a href="../howto/annotations.html" title="Annotations Howto">Annotations Howto</a>
            </li>
                      <li class="none">
                          <a href="../howto/configuration-howto.html" title="Configuration Howto">Configuration Howto</a>
            </li>
                      <li class="none">
                          <a href="../howto/extend-user-howto.html" title="Extend User Howto">Extend User Howto</a>
            </li>
                      <li class="none">
                          <a href="../howto/hibernate-howto.html" title="Hibernate OM Howto">Hibernate OM Howto</a>
            </li>
                      <li class="none">
                          <a href="../howto/intake-howto.html" title="Intake Howto">Intake Howto</a>
            </li>
                      <li class="none">
                          <a href="../howto/jsp-howto.html" title="JSP Howto">JSP Howto</a>
            </li>
                      <li class="none">
                          <a href="../howto/migrate-from-2_1-howto.html" title="Migrating from 2.1 to 2.2">Migrating from 2.1 to 2.2</a>
            </li>
                      <li class="none">
                          <a href="../howto/migrate-from-2_2-howto.html" title="Migrating from 2.2 to 2.3">Migrating from 2.2 to 2.3</a>
            </li>
                      <li class="none">
                          <a href="../howto/migrate-from-2_3-howto.html" title="Migrating from 2.3 to 4.0">Migrating from 2.3 to 4.0</a>
            </li>
                      <li class="none">
                          <a href="../howto/pullmodel-howto.html" title="Pull Model Howto">Pull Model Howto</a>
            </li>
                      <li class="none">
                          <a href="../howto/python-howto.html" title="Python Howto">Python Howto</a>
            </li>
                      <li class="none">
                          <a href="../howto/security-howto.html" title="Security Howto">Security Howto</a>
            </li>
                      <li class="none">
                          <a href="../howto/services-howto.html" title="Services Howto">Services Howto</a>
            </li>
                      <li class="none">
                          <a href="../howto/url-rewriting-howto.html" title="URL rewriting Howto">URL rewriting Howto</a>
            </li>
                      <li class="none">
            <strong>Velocity Context Howto</strong>
          </li>
                      <li class="none">
                          <a href="../howto/velocity-site-howto.html" title="Velocity Site Howto">Velocity Site Howto</a>
            </li>
                      <li class="none">
                          <a href="../howto/velocityonlylayout-howto.html" title="VelocityOnlyLayout Howto">VelocityOnlyLayout Howto</a>
            </li>
              </ul>
        </li>
                  <li class="none">
                          <a href="http://wiki.apache.org/turbine/FrontPage" class="externalLink" title="Wiki">Wiki</a>
            </li>
                  <li class="none">
                          <a href="../apidocs/index.html" title="JavaDocs">JavaDocs</a>
            </li>
          </ul>
                       <h5>Development</h5>
                  <ul>
                  <li class="none">
                          <a href="../proposals.html" title="Proposals">Proposals</a>
            </li>
                  <li class="none">
                          <a href="../how-to-help.html" title="How To Help">How To Help</a>
            </li>
                  <li class="none">
                          <a href="../todo.html" title="Todo">Todo</a>
            </li>
          </ul>
                       <h5>Project Documentation</h5>
                  <ul>
                                                                                                                                                                                                                                                                                            <li class="collapsed">
                          <a href="../project-info.html" title="Project Information">Project Information</a>
                  </li>
                                                                                                                                                                                                                                                                                            <li class="collapsed">
                          <a href="../project-reports.html" title="Project Reports">Project Reports</a>
                  </li>
          </ul>
                       <h5>Apache</h5>
                  <ul>
                  <li class="none">
                          <a href="http://www.apache.org/" class="externalLink" title="Apache Website">Apache Website</a>
            </li>
                  <li class="none">
                          <a href="http://www.apache.org/licenses/" class="externalLink" title="License">License</a>
            </li>
                  <li class="none">
                          <a href="http://www.apache.org/foundation/how-it-works.html" class="externalLink" title="How the ASF works">How the ASF works</a>
            </li>
                  <li class="none">
                          <a href="http://www.apache.org/foundation/sponsorship.html" class="externalLink" title="Sponsorship">Sponsorship</a>
            </li>
                  <li class="none">
                          <a href="http://www.apache.org/foundation/thanks.html" class="externalLink" title="Thanks">Thanks</a>
            </li>
                  <li class="none">
                          <a href="http://www.apache.org/security/" class="externalLink" title="Security">Security</a>
            </li>
          </ul>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="../images/logos/maven-feather.png" />
      </a>
                   
                    
            </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        <!-- Licensed to the Apache Software Foundation (ASF) under one
 or more contributor license agreements.  See the NOTICE file
 distributed with this work for additional information
 regarding copyright ownership.  The ASF licenses this file
 to you under the Apache License, Version 2.0 (the
 "License"); you may not use this file except in compliance
 with the License.  You may obtain a copy of the License at

   http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing,
 software distributed under the License is distributed on an
 "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 KIND, either express or implied.  See the License for the
 specific language governing permissions and limitations
 under the License. -->



<div class="section">
<h2>Using the Turbine Context<a name="Using_the_Turbine_Context"></a></h2>

<p>
The Turbine Templating Services attach references to default Objects in the
Turbine Context as part of their initialization. In the case of the
TurbineVelocityService these references point to RunData, TemplateLink and
TemplatePageAttributes. These three are put into the Context in the
TurbineVelocityService class. The Context stores the Objects in a Hashtable
with a key and the Object.
</p>
</div>


<div class="section">
<h2>Using the RunData Object<a name="Using_the_RunData_Object"></a></h2>

<p>
The RunData Object is referenced by the &quot;data&quot; keyword, which when using this
in the templating system is referenced by $data. As the Context contains a link
to the RunData object all the public methods in the RunData Object are made
available to the template. For example, typing $data.getMessage() will access
the message String being stored in the RunData Object and print that as part
of the templates output.
</p>


<p>
RunData exposes an extremely rich series of methods and fields, for a full list
of these methods refer to the Javadocs for RunData. Some of the useful methods
exposed in RunData include;
</p>


<p>
</p>
<ul>
    addMessage(String msg) <br />
    getMessage() <br />
    getParameters() <br />
    getServerName() <br />
    getTitle() <br />
    getUser() <br />
    removeUserFromSession() <br />
    setMessage(String message) <br />
    setRedirectUri(String ruri) <br />
    setTitle(String title) <br />
    setLayoutTemplate(String title) <br />
</ul>



<p>
The RunData also allows for access to the TemplateInfo Object via
getTemplateInfo() and several convenience methods. This allows for properties
of the Templates to be modified for a Request when using templating systems like
Velocity, WebMacro or Freemarker.
</p>


<p>
As an example assume we want a printable page that contains only the Templating
Screen and not all the navigational components. To achieve this we can strip
out all the non screen templating components by describing a new Layout Template
called PrintableLayout.vm in the templates/layouts directory. All the
PrintableLayout needs contain is;
</p>


<div class="source">
<pre>
    $screen_placeholder
</pre></div>


<p>
Without the references to the $navigation.setTemplate() methods in the template
no navigational screen will be called. In the Screen Template that wants to take
advantage of the PrintableLayout Template add to the Template;
</p>


<div class="source">
<pre>
    $data.setLayoutTemplate(&quot;/PrintableLayout.vm&quot;)
</pre></div>


<p>
This will strip the Screen Template of its Navigational components. These
convenience methods can also be used to expose and to set the Layout when the
Template is processed. Through this a User can potentially choose how they would
like their webpage to appear by choosing one of many differant Layouts or
choices you, the webdesigner provide.
</p>
</div>


<div class="section">
<h2>Using the TemplateLink Object<a name="Using_the_TemplateLink_Object"></a></h2>

<p>
The TemplateLink is an extended version of DynamicURI customised to be used in
the templates. The TemplateLink is referenced in the templates via $link and
exposes convenience methods for building URI's on the fly. For example in a
template to build the URI to another template, TemplateLink would be referenced
via;
</p>


<div class="source">
<pre>
    $link.setPage(&quot;newpage.vm&quot;)
</pre></div>


<p>
which when added to a Velocity template would (depending on the servlet
configuration) return;
</p>


<p>

<blockquote>
    http://127.0.0.1:8080/newapp/servlet/newapp/template/index.vm
</blockquote>
</p>


<p>
where &quot;newapp&quot; is the chosen webapp deployment name.
</p>


<p>
This same mechanism can also be used to link to static html;
</p>


<div class="source">
<pre>
    $link.setPage(&quot;/path/to/static.html&quot;)
</pre></div>


<p>
However the HTML page will load itself into a screen and not be embedded withint the Layouts and Navigations. If you still wish static content to be embedded within the specified layouts and navigations it is easier to add the static content as a velocity template and not take advantage of any of the dynamic content addition the Velocity Context allows.
</p>



<p>
TemplateLink and DynamicURI again expose a rich set of methods and fields to
the link reference, for a full list of fields and methods please refer to
TemplateLink and DynamicURI in the javadocs. Some of the useful methods
exposed are;
</p>


<p>
</p>
<ul>
    setPage(String templatename) <br />
    addPathInfo(ParameterParser pp) <br />
    addPathInfo(String name, String value) <br />
    addQueryData(ParameterParser pp) <br />
    addQueryData(String name, String value) <br />
    getScriptName() <br />
    getServerData() <br />
    getServerPort() <br />
    setAction(String action) <br />
    setScreen(String screen) <br />
    setSecure() <br />
</ul>

</div>


<div class="section">
<h2>Using the TemplatePageAttributes Object<a name="Using_the_TemplatePageAttributes_Object"></a></h2>

<p>
The TemplatePageAttributes is accessed from within the context by the keyword
&quot;page&quot; and provides methods to modify the various HTML attributes of the
templating system. The Template context can be used to dictate the style of
the HTML page in the navigation and layout templates as well as modify these
attributes from within a screen.
</p>


<p>
As an example in the default.vm the page can be set to a maroon background with;
</p>


<div class="source">
<pre>
    $page.setBgColor(&quot;#800000&quot;)
</pre></div>


<p>
the screen template may need to set a new title to the page being displayed in
the browser, this can be done in the screen template via;
</p>


<div class="source">
<pre>
    $page.setTitle(&quot;New Title to Page&quot;)
</pre></div>


<p>
Non standard attributes can be added to the Body tag, for instance the
leftmargin or topmargin attributes via;
</p>


<div class="source">
<pre>
    $page.addAttribute(&quot;topmargin&quot;, 0)
</pre></div>


<p>
Note though that the addAttribute method only adds attributes to the Body tag.
For a full list of methods exposed to the page reference view the Javadocs for
TemplatePageAttributes. Other methods exposed to the page reference are;
</p>


<p>
</p>
<ul>
    addAttribute(String name, String value) <br />
    getTitle() <br />
    setBackground(String url) <br />
    setBgColor(String color) <br />
    setDescription(String description) <br />
    setKeywords(String description) <br />
    setLinkColor(String color) <br />
    setStyleSheet(String url) <br />
    setTextColor(String color) <br />
    setTitle(String title) <br />
    setVLinkColor(String color) <br />
</ul>

</div>


<div class="section">
<h2>Adding your own Objects to the Context<a name="Adding_your_own_Objects_to_the_Context"></a></h2>

<p>
As the Context is stored as a Hashtable any Object can be placed inside
it and be accessed from a template. For instance, in a Velocity Screen
in the doBuildTemplate() method, a String could be added to the Context.
Please refer to the <a href="../getting-started.html">Getting
Started</a> documentation for more examples of using the Velocity
Context with screens and events.
</p>


<div class="source">
<pre>
    context.put(&quot;hello&quot;,new String(&quot;testing&quot;));
</pre></div>


<p>
This can be referenced from within the template via;
</p>


<div class="source">
<pre>
    $hello the hello reference
</pre></div>


<p>
which would be output as;
</p>


<div class="source">
<pre>
    testing the hello reference
</pre></div>
</div>


<div class="section">
<h2>Using an Image Object in the Context<a name="Using_an_Image_Object_in_the_Context"></a></h2>

<p>
Creating an HTML link to an image from a template could be done by;
</p>


<div class="source">
<pre>
   $link.getServerScheme()
   ://
   $link.getServerName()
   :
   $link.getServerPort()
   /context/imagename.jpg
</pre></div>


<p>
This has been split up into multiple lines for clarity. Doing this once is a
pain, doing it twice stinks, if the screen requires several images .... and
there are many screens .... it is a productivity killer. The Velocity Context
can be used to store this information and expose it to all the Screens
requiring it. To do this we can create an Image Object which extends the Turbine
DynamicURI Object. The following class is Jakarta Tomcat specific;
</p>



<div class="source">
<pre>
//Turbine
import org.apache.turbine.util.DynamicURI;
import org.apache.turbine.util.RunData;


public class Image extends DynamicURI
{

    /** The images directory */
    public static final String DIR = &quot;images&quot;;

    /** tomcat specific - tomcat context */
    private String contextpath;

    /** Constructor */
    public Image (RunData data)
    {
        super(data);

        //the Tomcat context
        contextpath = data.getRequest().getContextPath();
    }

    /** set the image and URI */
    public String setImage(String imagename)
    {
        return (
        getServerScheme() + //http
        &quot;://&quot; +
        getServerName()  + //www.foo.com
        &quot;:&quot; +
        getServerPort() + //port webserver running on

        //the context for tomcat adds a / so no need to add another

        contextpath  +  //the tomcat context
        &quot;/&quot; +
        Images.DIR +
        &quot;/&quot; +
        imagename);
    }
}
</pre></div>


<p>
This can be instantiated from within the doBuildTemplate method in a Velocity
Screen and added to the context from there;
</p>


<div class="source">
<pre>
    public void doBuildTemplate(RunData data, Context context) throws Exception
    {
        Image image = new Image(data);
        context.put(&quot;image&quot;,image);
    }
</pre></div>


<p>
from this the Image Object is accessible from within the corresponding screen
template and can be accessed by;
</p>


<div class="source">
<pre>
    $image.setImage(&quot;imagename.jpg&quot;);
</pre></div>


<p>
Which is much simpler than the original attempt at dynamically creating an image
URL. To make this Image object accessible across all Screens, sublass the
VelocityScreen Object with one that overrides the doBuildTemplate() method by
adding the Image object to the Velocity Context. Then use this class as the
parent class for the Screens that need access to the Image Object. For more
detail on taking advantage and extending the VelocityScreen Object, please view
the <a href="../getting-started.html">Getting Started</a> Document.
</p>


<p>
The above Image Object can also be modified to include any static data required
by the templates. For instance CSS files, JavaScript files etc. Instead of an
Image Object, it can be rewritten as a StaticLink Object;
</p>


<div class="source">
<pre>
//Turbine
import org.apache.turbine.util.DynamicURI;
import org.apache.turbine.util.RunData;


public class StaticLink extends DynamicURI
{

    /** the images directory */
    public static final String IMAGES = &quot;images&quot;;

    /** the css directory */
    public static final String CSS = &quot;css&quot;;

    // etc

    /** tomcat specific - tomcat context */
    private String contextpath;

    /** Constructor */
    public Image (RunData data)
    {
        super(data);

        //the Tomcat context
        contextpath = data.getRequest().getContextPath();
    }

    /** set the image and URI */
    public String setImage(String imagename)
    {
        //URI Logic
    }

    /** set the CSS style and URI*/
    public String setCss(String stylesheet)
    {
        //URI Logic
    }

    /** general set method, input as string
     *  ie can be set as $staticlink.setStaticLink(&quot;images/imagename&quot;)
     */
    public String setStaticLink(String staticlink)
    {
        //URI Logic
    }

}

</pre></div>
</div>


<div class="section">
<h2>Using the Context Object with the Base/Peer OM<a name="Using_the_Context_Object_with_the_BasePeer_OM"></a></h2>

<p>
As a more complex example, assume we are building a book archive system,
where users can search for books by author and title. If we search on author
&quot;Greg Egan&quot; and title &quot;Permutation City&quot;, we can query the database through the
base\peer system and return a Book Object that contains the information on the
book &quot;Permutation City&quot;. The Book Object would be placed in the context via;
</p>


<div class="source">
<pre>
    Book book = new Book();

    //add the data to the Book Object
    //from the Base/Peer Objects for Book

    context.put(&quot;book&quot;, book);

</pre></div>


<p>
and then accessed in the velocity template by;
</p>


<div class="source">
<pre>
    $book.getAuthor()
    $book.getTitle()
</pre></div>


<p>
where the two methods are public methods in the Book Object, in this case built
by the <a href="torque.html">Torque Tool</a>. These methods would return;
</p>


<div class="source">
<pre>
    Greg Egan
    Permutation City
</pre></div>


<p>
It is important not to try and put Objects with value null into the Context.
A NullPointerException will be returned. This above example is intended to get
across how the Velocity Context can be used to store data from the Base/Peer
system that can be accessed from the Templates.
</p>
</div>



      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
              Copyright &#169;                    2000-2015
                        <a href="http://www.apache.org/">The Apache Software Foundation</a>.
            All Rights Reserved.      
                    
                  </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>