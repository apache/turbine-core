<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html><head><title>Turbine - Context Howto</title><style type="text/css" media="all">
          @import url("../style/maven-base.css");
          
          @import url("../style/maven-theme.css");</style><link rel="stylesheet" href="../style/print.css" type="text/css" media="print"></link><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"></meta><meta name="author" content="Turbine Documentation Team"></meta><meta name="email" content="a@a.com"></meta><meta name="author" content="Cameron Riley"></meta><meta name="email" content="criley@ekmail.com"></meta></head><body class="composite"><div id="banner"><a href="http://turbine.apache.org/" id="organizationLogo"><img alt="Apache Software Foundation" src="../images/turbine-project.png"></img></a><a href="http://turbine.apache.org/turbine/turbine-2.3.3/index.html" id="projectLogo"><img alt="turbine-2" src="../images/logo.gif"></img></a><div class="clear"><hr></hr></div></div><div id="breadcrumbs"><div class="xleft">Last published: 21 November 2008
                <span class="separator">|</span> Doc for  2.3.3
                </div><div class="xright">
        
        <a href="http://turbine.apache.org/">Turbine Home</a>
      
        
          
            <span class="separator">|</span>
          
        
        <a href="http://turbine.apache.org/fulcrum/">Fulcrum</a>
      
        
          
            <span class="separator">|</span>
          
        
        <a href="http://turbine.apache.org/meta/">META</a>
      </div><div class="clear"><hr></hr></div></div><div id="leftColumn"><div id="navcolumn"><div id="menuGeneral_Information"><h5>General Information</h5><ul><li class="none"><a href="../index.html">Overview</a></li><li class="none"><a href="../features.html">Features</a></li><li class="none"><a href="../fsd.html">Specification</a></li><li class="none"><a href="../getting-started.html">Getting Started</a></li></ul></div><div id="menuDocumentation"><h5>Documentation</h5><ul><li class="none"><a href="../changes-report.html">Changes</a></li><li class="none"><a href="../turbine-schema.html">Core DB Schema</a></li><li class="collapsed"><a href="../services/index.html">Services</a></li><li class="expanded"><a href="../howto/index.html">Howtos</a><ul><li class="none"><a href="../howto/action-event-howto.html">Action Events Howto</a></li><li class="none"><a href="../howto/configuration-howto.html">Configuration Howto</a></li><li class="none"><a href="../howto/extend-user-howto.html">Extend User Howto</a></li><li class="none"><a href="../howto/hibernate-howto.html">Hibernate OM Howto</a></li><li class="none"><a href="../howto/intake-howto.html">Intake Howto</a></li><li class="none"><a href="../howto/jboss-howto.html">JBoss Howto</a></li><li class="none"><a href="../howto/jsp-howto.html">JSP Howto</a></li><li class="none"><a href="../howto/migrate-from-2_1-howto.html">Migrating 2.1 to 2.2</a></li><li class="none"><a href="../howto/migrate-from-2_2-howto.html">Migrating 2.2 to 2.3</a></li><li class="none"><a href="../howto/pullmodel-howto.html">Pull Model Howto</a></li><li class="none"><a href="../howto/python-howto.html">Python Howto</a></li><li class="none"><a href="../howto/security-howto.html">Security Howto</a></li><li class="none"><a href="../howto/services-howto.html">Services Howto</a></li><li class="none"><a href="../howto/sql-howto.html">How to build the SQL files</a></li><li class="none"><a href="../howto/url-rewriting-howto.html">URL rewriting Howto</a></li><li class="none"><strong><a href="../howto/context-howto.html">Velocity Context Howto</a></strong></li><li class="none"><a href="../howto/velocity-site-howto.html">Velocity Site Howto</a></li><li class="none"><a href="../howto/velocityonlylayout-howto.html">VelocityOnlyLayout Howto</a></li><li class="none"><a href="http://wiki.apache.org/turbine/Turbine2" class="externalLink" title="External Link">Wiki Howtos</a></li></ul></li><li class="none"><a href="../apidocs/index.html">JavaDocs</a></li></ul></div><div id="menuDevelopment"><h5>Development</h5><ul><li class="none"><a href="../proposals.html">Proposals</a></li><li class="none"><a href="../how-to-help.html">How To Help</a></li><li class="none"><a href="../todo.html">Todo</a></li></ul></div><div id="menuProject_Documentation"><h5>Project Documentation</h5><ul><li class="none"><a href="../index.html">About</a></li><li class="collapsed"><a href="../project-info.html">Project Info</a></li><li class="collapsed"><a href="../maven-reports.html">Project Reports</a></li><li class="none"><a href="../development-process.html">Development Process</a></li></ul></div><div id="legend"><h5>Legend</h5><ul><li class="externalLink">External Link</li><li class="newWindow">Opens in a new window</li></ul></div><a href="http://maven.apache.org/" title="Built by Maven" id="poweredBy"><img alt="Built by Maven" src="../images/logos/mavenlogo_builtby_w.png"></img></a></div></div><div id="bodyColumn"><div class="contentBox"><div class="section"><a name="Using_the_Turbine_Context"></a><h2>Using the Turbine Context</h2>
<p>
The Turbine Templating Services attach references to default Objects in the
Turbine Context as part of their initialization. In the case of the
TurbineVelocityService these references point to RunData, TemplateLink and
HtmlPageAttributes. These three are put into the Context in the
TurbineVelocityService class. The Context stores the Objects in a Hashtable
with a key and the Object.
</p>
</div><div class="section"><a name="Using_the_RunData_Object"></a><h2>Using the RunData Object</h2>
<p>
The RunData Object is referenced by the "data" keyword, which when using this
in the templating system is referenced by $data. As the Context contains a link
to the RunData object all the public methods in the RunData Object are made
available to the template. For example, typing $data.getMessage() will access
the message String being stored in the RunData Object and print that as part
of the templates output.
</p>

<p>
RunData exposes an extremely rich series of methods and fields, for a full list
of these methods refer to the Javadocs for RunData. Some of the useful methods
exposed in RunData include;
</p>

<p>
<ul>
    addMessage(String msg) <br></br>
    getMessage() <br></br>
    getParameters() <br></br>
    getServerName() <br></br>
    getTitle() <br></br>
    getUser() <br></br>
    removeUserFromSession() <br></br>
    setMessage(String message) <br></br>
    setRedirectUri(String ruri) <br></br>
    setTitle(String title) <br></br>
</ul>
</p>

<p>
The RunData also allows for access to the TemplateInfo Object via
getTemplateInfo() and several convenience methods. This allows for properties
of the Templates to be modified for a Request when using templating systems like
Velocity, WebMacro or Freemarker.
</p>

<p>
As an example assume we want a printable page that contains only the Templating
Screen and not all the navigational components. To achieve this we can strip
out all the non screen templating components by describing a new Layout Template
called PrintableLayout.vm in the templates/layouts directory. All the
PrintableLayout needs contain is;
</p>


    <div class="source"><pre>
    $screen_placeholder
</pre></div>
  

<p>
Without the references to the $navigation.setTemplate() methods in the template
no navigational screen will be called. In the Screen Template that wants to take
advantage of the PrintableLayout Template add to the Template;
</p>


    <div class="source"><pre>
    $data.setLayoutTemplate("PrintableLayout.vm")
</pre></div>
  

<p>
This will strip the Screen Template of its Navigational components. These
convenience methods can also be used to expose and to set the Layout when the
Template is processed. Through this a User can potentially choose how they would
like their webpage to appear by choosing one of many different Layouts or
choices you, the webdesigner provide.
</p>

</div><div class="section"><a name="Using_the_TemplateLink_Object"></a><h2>Using the TemplateLink Object</h2>
<p>
The TemplateLink is an extended version of DynamicURI customised to be used in
the templates. The TemplateLink is referenced in the templates via $link and
exposes convenience methods for building URI's on the fly. For example in a
template to build the URI to another template, TemplateLink would be referenced
via;
</p>


    <div class="source"><pre>
    $link.setPage("newpage.vm")
</pre></div>
  

<p>
which when added to a Velocity template in the TDK that is running as localhost,
would return;
</p>

<p>
<blockquote>
    http://127.0.0.1:8080/newapp/servlet/newapp/template/index.vm
</blockquote>
</p>

<p>
where "newapp" is the chosen webapp deployment name.
</p>

<p>
However the HTML page will load itself into a screen and not be embedded within
the Layouts and Navigations. If you still wish static content to be embedded
within the specified layouts and navigations it is easier to add the static
content as a velocity template and not take advantage of any of the dynamic
content addition the Velocity Context allows.
</p>


<p>
TemplateLink and DynamicURI again expose a rich set of methods and fields to
the link reference, for a full list of fields and methods please refer to
TemplateLink and DynamicURI in the javadocs. Some of the useful methods
exposed are;
</p>

<p>
<ul>
    setPage(String templatename) <br></br>
    addPathInfo(ParameterParser pp) <br></br>
    addPathInfo(String name, String value) <br></br>
    addQueryData(ParameterParser pp) <br></br>
    addQueryData(String name, String value) <br></br>
    getScriptName() <br></br>
    getServerData() <br></br>
    getServerPort() <br></br>
    setAction(String action) <br></br>
    setScreen(String screen) <br></br>
    setSecure() <br></br>
</ul>
</p>
</div><div class="section"><a name="Using_the_HtmlPageAttributes_Object"></a><h2>Using the HtmlPageAttributes Object</h2>
<p>
The HtmlPageAttributes is accessed from within the context by the keyword
"page" and provides methods to modify the various HTML attributes of the
templating system. The Template context can be used to dictate the style of
the HTML page in the navigation and layout templates as well as modify these
attributes from within a screen.
</p>

<p>
As an example in the default.vm the page can be set to a maroon background with;
</p>


    <div class="source"><pre>
    $page.setBgColor("#800000")
</pre></div>
  

<p>
the screen template may need to set a new title to the page being displayed in
the browser, this can be done in the screen template via;
</p>


    <div class="source"><pre>
    $page.setTitle("New Title to Page")
</pre></div>
  

<p>
Non standard attributes can be added to the Body tag, for instance the
leftmargin or topmargin attributes via;
</p>


    <div class="source"><pre>
    $page.addBodyAttribute("topmargin", 0)
</pre></div>
  

<p>
For a full list of methods exposed to the page reference view the Javadocs for
HtmlPageAttributes. Other methods exposed to the page reference are;
</p>

<p>
<ul>
    addAttribute(String name, String value) <br></br>
    getTitle() <br></br>
    setBackground(String url) <br></br>
    setBgColor(String color) <br></br>
    setDescription(String description) <br></br>
    setKeywords(String description) <br></br>
    setLinkColor(String color) <br></br>
    setStyleSheet(String url) <br></br>
    setTextColor(String color) <br></br>
    setTitle(String title) <br></br>
    setVLinkColor(String color) <br></br>
</ul>
</p>
</div><div class="section"><a name="Adding_your_own_Objects_to_the_Context"></a><h2>Adding your own Objects to the Context</h2>
<p>
As the Context is stored as a Hashtable any Object can be placed inside
it and be accessed from a template. For instance, in a Velocity Screen
in the doBuildTemplate() method, a String could be added to the Context.
Please refer to the <a href="../getting-started.html">Getting
Started</a> documentation for more examples of using the Velocity
Context with screens and events.
</p>


    <div class="source"><pre>
    context.put("hello",new String("testing"));
</pre></div>
  

<p>
This can be referenced from within the template via;
</p>


    <div class="source"><pre>
    $hello the hello reference
</pre></div>
  

<p>
which would be output as;
</p>


    <div class="source"><pre>
    testing the hello reference
</pre></div>
  
</div><div class="section"><a name="Using_an_Image_Object_in_the_Context"></a><h2>Using an Image Object in the Context</h2>
<p>
Creating an HTML link to an image from a template could be done by;
</p>


    <div class="source"><pre>
   $link.getServerScheme()
   ://
   $link.getServerName()
   :
   $link.getServerPort()
   /context/imagename.jpg
</pre></div>
  

<p>
This has been split up into multiple lines for clarity. Doing this once is a
pain, doing it twice stinks, if the screen requires several images .... and
there are many screens .... it is a productivity killer. The Velocity Context
can be used to store this information and expose it to all the Screens
requiring it. To do this we can create an Image Object which extends the Turbine
DynamicURI Object. The following class is Apache Tomcat specific;
</p>



    <div class="source"><pre>
//Turbine
import org.apache.turbine.util.DynamicURI;
import org.apache.turbine.util.RunData;


public class Image extends DynamicURI
{

    /** The images directory */
    public static final String DIR = "images";

    /** tomcat specific - tomcat context */
    private String contextpath;

    /** Constructor */
    public Image (RunData data)
    {
        super(data);

        //the Tomcat context
        contextpath = data.getRequest().getContextPath();
    }

    /** set the image and URI */
    public String setImage(String imagename)
    {
        return (
        getServerScheme() + //http
        "://" +
        getServerName()  + //www.foo.com
        ":" +
        getServerPort() + //port webserver running on (8080 for TDK)

        //the context for tomcat adds a / so no need to add another

        contextpath  +  //the tomcat context
        "/" +
        Images.DIR +
        "/" +
        imagename);
    }
}
</pre></div>
  

<p>
This can be instantiated from within the doBuildTemplate method in a Velocity
Screen and added to the context from there;
</p>


    <div class="source"><pre>
    public void doBuildTemplate(RunData data, Context context) throws Exception
    {
        Image image = new Image(data);
        context.put("image",image);
    }
</pre></div>
  

<p>
from this the Image Object is accessible from within the corresponding screen
template and can be accessed by;
</p>


    <div class="source"><pre>
    $image.setImage("imagename.jpg");
</pre></div>
  

<p>
Which is much simpler than the original attempt at dynamically creating an image
URL. To make this Image object accessible across all Screens, subclass the
VelocityScreen Object with one that overrides the doBuildTemplate() method by
adding the Image object to the Velocity Context. Then use this class as the
parent class for the Screens that need access to the Image Object. For more
detail on taking advantage and extending the VelocityScreen Object, please view
the <a href="../getting-started.html">Getting Started</a> Document.
</p>

<p>
The above Image Object can also be modified to include any static data required
by the templates. For instance CSS files, JavaScript files etc. Instead of an
Image Object, it can be rewritten as a StaticLink Object;
</p>


    <div class="source"><pre>
//Turbine
import org.apache.turbine.util.DynamicURI;
import org.apache.turbine.util.RunData;


public class StaticLink extends DynamicURI
{

    /** the images directory */
    public static final String IMAGES = "images";

    /** the css directory */
    public static final String CSS = "css";

    // etc

    /** tomcat specific - tomcat context */
    private String contextpath;

    /** Constructor */
    public Image (RunData data)
    {
        super(data);

        //the Tomcat context
        contextpath = data.getRequest().getContextPath();
    }

    /** set the image and URI */
    public String setImage(String imagename)
    {
        //URI Logic
    }

    /** set the CSS style and URI*/
    public String setCss(String stylesheet)
    {
        //URI Logic
    }

    /** general set method, input as string
     *  ie can be set as $staticlink.setStaticLink("images/imagename")
     */
    public String setStaticLink(String staticlink)
    {
        //URI Logic
    }

}

</pre></div>
  
</div><div class="section"><a name="Using_the_Context_Object_with_the_Base_Peer_OM"></a><h2>Using the Context Object with the Base/Peer OM</h2>
<p>
As a more complex example, assume we are building a book archive system,
where users can search for books by author and title. If we search on author
"Greg Egan" and title "Permutation City", we can query the database through the
base\peer system and return a Book Object that contains the information on the
book "Permutation City". The Book Object would be placed in the context via;
</p>


    <div class="source"><pre>
    Book book = new Book();

    //add the data to the Book Object
    //from the Base/Peer Objects for Book

    context.put("book", book);

</pre></div>
  

<p>
and then accessed in the velocity template by;
</p>


    <div class="source"><pre>
    $book.getAuthor()
    $book.getTitle()
</pre></div>
  

<p>
where the two methods are public methods in the Book Object, in this case built
by the <a href="http://db.apache.org/torque/" class="externalLink" title="External Link">Torque</a>. These methods would return;
</p>


    <div class="source"><pre>
    Greg Egan
    Permutation City
</pre></div>
  

<p>
It is important not to try and put Objects with value null into the Context.
A NullPointerException will be returned. This above example is intended to get
across how the Velocity Context can be used to store data from the Base/Peer
system that can be accessed from the Templates.
</p>
</div></div></div><div class="clear"><hr></hr></div><div id="footer"><div class="xright">© 2000-2008, Apache Software Foundation</div><div class="clear"><hr></hr></div></div></body></html>