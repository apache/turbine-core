<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.9.2 from xdocs/howto\context-howto.xml at 21 September 2021
 | Rendered using Apache Maven Fluido Skin 1.9
-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 1.9.2" />
    <title>Apache Turbine &#x2013; Context Howto</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.9.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />
    <script src="../js/apache-maven-fluido-1.9.min.js"></script>
<link rel="icon" type="image/png" sizes="48x48" href="./images/favicon.ico"> 
      <link rel="icon" type="image/png" sizes="48x48" href="../images/favicon.ico"> 
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
  </head>
  <body class="topBarDisabled">
    <div class="container-fluid">
      <header>
        <div id="banner">
          <div class="pull-left"><a href="../../" id="bannerLeft" title="Apache Turbine"><img src="../images/turbine-project-apache-separate.png"  alt="Apache Turbine"/></a></div>
          <div class="pull-right"><div id="bannerRight"><img src="../images/logo.gif"  alt=""/></div>
</div>
          <div class="clear"><hr/></div>
        </div>

        <div id="breadcrumbs">
          <ul class="breadcrumb">
        <li id="publishDate">Last Published: 21 September 2021<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 5.1-SNAPSHOT</li>
      <li class="pull-right"><span class="divider">|</span>
<a href="https://turbine.apache.org/fulcrum/" class="externalLink" title="Fulcrum">Fulcrum</a></li>
      <li class="pull-right"><span class="divider">|</span>
<a href="https://turbine.apache.org/" class="externalLink" title="Turbine">Turbine</a></li>
      <li class="pull-right"><a href="https://www.apache.org" class="externalLink" title="Apache">Apache</a></li>
          </ul>
        </div>
      </header>
      <div class="row-fluid">
        <header id="leftColumn" class="span2">
          <nav class="well sidebar-nav">
  <ul class="nav nav-list">
   <li class="nav-header">General Information</li>
    <li><a href="../index.html" title="Overview"><span class="none"></span>Overview</a></li>
    <li><a href="../features.html" title="Features"><span class="none"></span>Features</a></li>
    <li><a href="../fsd.html" title="Specification"><span class="none"></span>Specification</a></li>
    <li><a href="../getting-started.html" title="Getting Started"><span class="none"></span>Getting Started</a></li>
    <li><a href="../how-to-build.html" title="Howto Build Turbine"><span class="none"></span>Howto Build Turbine</a></li>
    <li><a href="../changes-report.html" title="Changes"><span class="none"></span>Changes</a></li>
   <li class="nav-header">Documentation</li>
    <li><a href="../services/index.html" title="Services"><span class="icon-chevron-right"></span>Services</a></li>
    <li><a href="../howto/index.html" title="Howtos"><span class="icon-chevron-down"></span>Howtos</a>
     <ul class="nav nav-list">
      <li><a href="../howto/action-event-howto.html" title="Action Events Howto"><span class="none"></span>Action Events Howto</a></li>
      <li><a href="../howto/annotations.html" title="Annotations Howto"><span class="none"></span>Annotations Howto</a></li>
      <li><a href="../howto/configuration-howto.html" title="Configuration Howto"><span class="none"></span>Configuration Howto</a></li>
      <li><a href="../howto/extend-user-howto.html" title="Extend User Howto"><span class="none"></span>Extend User Howto</a></li>
      <li><a href="../howto/hibernate-howto.html" title="Hibernate OM Howto"><span class="none"></span>Hibernate OM Howto</a></li>
      <li><a href="../howto/intake-howto.html" title="Intake Howto"><span class="none"></span>Intake Howto</a></li>
      <li><a href="../howto/jsp-howto.html" title="JSP Howto"><span class="none"></span>JSP Howto</a></li>
      <li><a href="../howto/migrate-from-2_1-howto.html" title="Migrating from 2.1 to 2.2"><span class="none"></span>Migrating from 2.1 to 2.2</a></li>
      <li><a href="../howto/migrate-from-2_2-howto.html" title="Migrating from 2.2 to 2.3"><span class="none"></span>Migrating from 2.2 to 2.3</a></li>
      <li><a href="../howto/migrate-from-2_3-howto.html" title="Migrating from 2.3 to 4.0"><span class="none"></span>Migrating from 2.3 to 4.0</a></li>
      <li><a href="../howto/migrate-from-4_0-howto.html" title="Migrating from 4.0 to 5.0"><span class="none"></span>Migrating from 4.0 to 5.0</a></li>
      <li><a href="../howto/pullmodel-howto.html" title="Pull Model Howto"><span class="none"></span>Pull Model Howto</a></li>
      <li><a href="../howto/python-howto.html" title="Python Howto"><span class="none"></span>Python Howto</a></li>
      <li><a href="../howto/security-howto.html" title="Security Howto"><span class="none"></span>Security Howto</a></li>
      <li><a href="../howto/services-howto.html" title="Services Howto"><span class="none"></span>Services Howto</a></li>
      <li><a href="../howto/url-mapper-howto.html" title="URL Simplifier Howto"><span class="none"></span>URL Simplifier Howto</a></li>
      <li><a href="../howto/url-rewriting-howto.html" title="URL Rewriting Howto"><span class="none"></span>URL Rewriting Howto</a></li>
      <li class="active"><a href="#"><span class="none"></span>Velocity Context Howto</a></li>
      <li><a href="../howto/velocity-site-howto.html" title="Velocity Site Howto"><span class="none"></span>Velocity Site Howto</a></li>
      <li><a href="../howto/velocityonlylayout-howto.html" title="VelocityOnlyLayout Howto"><span class="none"></span>VelocityOnlyLayout Howto</a></li>
     </ul></li>
    <li><a href="https://cwiki.apache.org/confluence/display/TURBINE" class="externalLink" title="Wiki"><span class="none"></span>Wiki</a></li>
    <li><a href="../apidocs/index.html" title="JavaDocs"><span class="none"></span>JavaDocs</a></li>
   <li class="nav-header">Development</li>
    <li><a href="../proposals.html" title="Proposals"><span class="none"></span>Proposals</a></li>
    <li><a href="../how-to-help.html" title="How To Help"><span class="none"></span>How To Help</a></li>
    <li><a href="../todo.html" title="Todo"><span class="none"></span>Todo</a></li>
   <li class="nav-header">Project Documentation</li>
    <li><a href="../project-info.html" title="Project Information"><span class="icon-chevron-right"></span>Project Information</a></li>
    <li><a href="../project-reports.html" title="Project Reports"><span class="icon-chevron-right"></span>Project Reports</a></li>
   <li class="nav-header">Apache</li>
    <li><a href="https://www.apache.org/" class="externalLink" title="Apache Website"><span class="none"></span>Apache Website</a></li>
    <li><a href="https://www.apache.org/licenses/" class="externalLink" title="License"><span class="none"></span>License</a></li>
    <li><a href="https://www.apache.org/foundation/how-it-works.html" class="externalLink" title="How the ASF works"><span class="none"></span>How the ASF works</a></li>
    <li><a href="https://www.apache.org/foundation/sponsorship.html" class="externalLink" title="Sponsorship"><span class="none"></span>Sponsorship</a></li>
    <li><a href="https://www.apache.org/foundation/thanks.html" class="externalLink" title="Thanks"><span class="none"></span>Thanks</a></li>
    <li><a href="https://www.apache.org/security/" class="externalLink" title="Security"><span class="none"></span>Security</a></li>
  </ul>
          </nav>
          <div class="well sidebar-nav">
            <hr />
            <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
<a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="../images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </header>
        <main id="bodyColumn"  class="span10" >




<section>
<h2><a name="Using_the_Turbine_Context"></a>Using the Turbine Context</h2>

<p>
The Turbine Templating Services attach references to default Objects in the
Turbine Context as part of their initialization. In the case of the
TurbineVelocityService these references point to RunData, TemplateLink and
TemplatePageAttributes. These three are put into the Context in the
TurbineVelocityService class. The Context stores the Objects in a Hashtable
with a key and the Object.
</p>
</section>

<section>
<h2><a name="Using_the_RunData_Object"></a>Using the RunData Object</h2>

<p>
The RunData Object is referenced by the &quot;data&quot; keyword, which when using this
in the templating system is referenced by $data. As the Context contains a link
to the RunData object all the public methods in the RunData Object are made
available to the template. For example, typing $data.getMessage() will access
the message String being stored in the RunData Object and print that as part
of the templates output.
</p>


<p>
RunData exposes an extremely rich series of methods and fields, for a full list
of these methods refer to the Javadocs for RunData. Some of the useful methods
exposed in RunData include;
</p>


<p>
</p>
<ul>
    addMessage(String msg) <br />
    getMessage() <br />
    getParameters() <br />
    getServerName() <br />
    getTitle() <br />
    getUser() <br />
    removeUserFromSession() <br />
    setMessage(String message) <br />
    setRedirectUri(String ruri) <br />
    setTitle(String title) <br />
    setLayoutTemplate(String title) <br />
</ul>



<p>
The RunData also allows for access to the TemplateInfo Object via
getTemplateInfo() and several convenience methods. This allows for properties
of the Templates to be modified for a Request when using templating systems like
Velocity, WebMacro or Freemarker.
</p>


<p>
As an example assume we want a printable page that contains only the Templating
Screen and not all the navigational components. To achieve this we can strip
out all the non screen templating components by describing a new Layout Template
called PrintableLayout.vm in the templates/layouts directory. All the
PrintableLayout needs contain is;
</p>


<div class="source"><pre class="prettyprint">
    $screen_placeholder
</pre></div>


<p>
Without the references to the $navigation.setTemplate() methods in the template
no navigational screen will be called. In the Screen Template that wants to take
advantage of the PrintableLayout Template add to the Template;
</p>


<div class="source"><pre class="prettyprint">
    $data.setLayoutTemplate(&quot;/PrintableLayout.vm&quot;)
</pre></div>


<p>
This will strip the Screen Template of its Navigational components. These
convenience methods can also be used to expose and to set the Layout when the
Template is processed. Through this a User can potentially choose how they would
like their webpage to appear by choosing one of many differant Layouts or
choices you, the webdesigner provide.
</p>
</section>

<section>
<h2><a name="Using_the_TemplateLink_Object"></a>Using the TemplateLink Object</h2>

<p>
The TemplateLink is an extended version of DynamicURI customised to be used in
the templates. The TemplateLink is referenced in the templates via $link and
exposes convenience methods for building URI's on the fly. For example in a
template to build the URI to another template, TemplateLink would be referenced
via;
</p>


<div class="source"><pre class="prettyprint">
    $link.setPage(&quot;newpage.vm&quot;)
</pre></div>


<p>
which when added to a Velocity template would (depending on the servlet
configuration) return;
</p>


<p>

<blockquote>
    http://127.0.0.1:8080/newapp/servlet/newapp/template/index.vm
</blockquote>
</p>


<p>
where &quot;newapp&quot; is the chosen webapp deployment name.
</p>


<p>
This same mechanism can also be used to link to static html;
</p>


<div class="source"><pre class="prettyprint">
    $link.setPage(&quot;/path/to/static.html&quot;)
</pre></div>


<p>
However the HTML page will load itself into a screen and not be embedded withint the Layouts and Navigations. If you still wish static content to be embedded within the specified layouts and navigations it is easier to add the static content as a velocity template and not take advantage of any of the dynamic content addition the Velocity Context allows.
</p>



<p>
TemplateLink and DynamicURI again expose a rich set of methods and fields to
the link reference, for a full list of fields and methods please refer to
TemplateLink and DynamicURI in the javadocs. Some of the useful methods
exposed are;
</p>


<p>
</p>
<ul>
    setPage(String templatename) <br />
    addPathInfo(ParameterParser pp) <br />
    addPathInfo(String name, String value) <br />
    addQueryData(ParameterParser pp) <br />
    addQueryData(String name, String value) <br />
    getScriptName() <br />
    getServerData() <br />
    getServerPort() <br />
    setAction(String action) <br />
    setScreen(String screen) <br />
    setSecure() <br />
</ul>

</section>

<section>
<h2><a name="Using_the_TemplatePageAttributes_Object"></a>Using the TemplatePageAttributes Object</h2>

<p>
The TemplatePageAttributes is accessed from within the context by the keyword
&quot;page&quot; and provides methods to modify the various HTML attributes of the
templating system. The Template context can be used to dictate the style of
the HTML page in the navigation and layout templates as well as modify these
attributes from within a screen.
</p>


<p>
As an example in the default.vm the page can be set to a maroon background with;
</p>


<div class="source"><pre class="prettyprint">
    $page.setBgColor(&quot;#800000&quot;)
</pre></div>


<p>
the screen template may need to set a new title to the page being displayed in
the browser, this can be done in the screen template via;
</p>


<div class="source"><pre class="prettyprint">
    $page.setTitle(&quot;New Title to Page&quot;)
</pre></div>


<p>
Non standard attributes can be added to the Body tag, for instance the
leftmargin or topmargin attributes via;
</p>


<div class="source"><pre class="prettyprint">
    $page.addAttribute(&quot;topmargin&quot;, 0)
</pre></div>


<p>
Note though that the addAttribute method only adds attributes to the Body tag.
For a full list of methods exposed to the page reference view the Javadocs for
TemplatePageAttributes. Other methods exposed to the page reference are;
</p>


<p>
</p>
<ul>
    addAttribute(String name, String value) <br />
    getTitle() <br />
    setBackground(String url) <br />
    setBgColor(String color) <br />
    setDescription(String description) <br />
    setKeywords(String description) <br />
    setLinkColor(String color) <br />
    setStyleSheet(String url) <br />
    setTextColor(String color) <br />
    setTitle(String title) <br />
    setVLinkColor(String color) <br />
</ul>

</section>

<section>
<h2><a name="Adding_your_own_Objects_to_the_Context"></a>Adding your own Objects to the Context</h2>

<p>
As the Context is stored as a Hashtable any Object can be placed inside
it and be accessed from a template. For instance, in a Velocity Screen
in the doBuildTemplate() method, a String could be added to the Context.
Please refer to the <a href="../getting-started.html">Getting
Started</a> documentation for more examples of using the Velocity
Context with screens and events.
</p>


<div class="source"><pre class="prettyprint">
    context.put(&quot;hello&quot;,new String(&quot;testing&quot;));
</pre></div>


<p>
This can be referenced from within the template via;
</p>


<div class="source"><pre class="prettyprint">
    $hello the hello reference
</pre></div>


<p>
which would be output as;
</p>


<div class="source"><pre class="prettyprint">
    testing the hello reference
</pre></div>
</section>

<section>
<h2><a name="Using_an_Image_Object_in_the_Context"></a>Using an Image Object in the Context</h2>

<p>
Creating an HTML link to an image from a template could be done by;
</p>


<div class="source"><pre class="prettyprint">
   $link.getServerScheme()
   ://
   $link.getServerName()
   :
   $link.getServerPort()
   /context/imagename.jpg
</pre></div>


<p>
This has been split up into multiple lines for clarity. Doing this once is a
pain, doing it twice stinks, if the screen requires several images .... and
there are many screens .... it is a productivity killer. The Velocity Context
can be used to store this information and expose it to all the Screens
requiring it. To do this we can create an Image Object which extends the Turbine
DynamicURI Object. The following class is Jakarta Tomcat specific;
</p>



<div class="source"><pre class="prettyprint">
//Turbine
import org.apache.turbine.util.DynamicURI;
import org.apache.turbine.util.RunData;


public class Image extends DynamicURI
{

    /** The images directory */
    public static final String DIR = &quot;images&quot;;

    /** tomcat specific - tomcat context */
    private String contextpath;

    /** Constructor */
    public Image (RunData data)
    {
        super(data);

        //the Tomcat context
        contextpath = data.getRequest().getContextPath();
    }

    /** set the image and URI */
    public String setImage(String imagename)
    {
        return (
        getServerScheme() + //http
        &quot;://&quot; +
        getServerName()  + //www.foo.com
        &quot;:&quot; +
        getServerPort() + //port webserver running on

        //the context for tomcat adds a / so no need to add another

        contextpath  +  //the tomcat context
        &quot;/&quot; +
        Images.DIR +
        &quot;/&quot; +
        imagename);
    }
}
</pre></div>


<p>
This can be instantiated from within the doBuildTemplate method in a Velocity
Screen and added to the context from there;
</p>


<div class="source"><pre class="prettyprint">
    public void doBuildTemplate(RunData data, Context context) throws Exception
    {
        Image image = new Image(data);
        context.put(&quot;image&quot;,image);
    }
</pre></div>


<p>
from this the Image Object is accessible from within the corresponding screen
template and can be accessed by;
</p>


<div class="source"><pre class="prettyprint">
    $image.setImage(&quot;imagename.jpg&quot;);
</pre></div>


<p>
Which is much simpler than the original attempt at dynamically creating an image
URL. To make this Image object accessible across all Screens, sublass the
VelocityScreen Object with one that overrides the doBuildTemplate() method by
adding the Image object to the Velocity Context. Then use this class as the
parent class for the Screens that need access to the Image Object. For more
detail on taking advantage and extending the VelocityScreen Object, please view
the <a href="../getting-started.html">Getting Started</a> Document.
</p>


<p>
The above Image Object can also be modified to include any static data required
by the templates. For instance CSS files, JavaScript files etc. Instead of an
Image Object, it can be rewritten as a StaticLink Object;
</p>


<div class="source"><pre class="prettyprint">
//Turbine
import org.apache.turbine.util.DynamicURI;
import org.apache.turbine.util.RunData;


public class StaticLink extends DynamicURI
{

    /** the images directory */
    public static final String IMAGES = &quot;images&quot;;

    /** the css directory */
    public static final String CSS = &quot;css&quot;;

    // etc

    /** tomcat specific - tomcat context */
    private String contextpath;

    /** Constructor */
    public Image (RunData data)
    {
        super(data);

        //the Tomcat context
        contextpath = data.getRequest().getContextPath();
    }

    /** set the image and URI */
    public String setImage(String imagename)
    {
        //URI Logic
    }

    /** set the CSS style and URI*/
    public String setCss(String stylesheet)
    {
        //URI Logic
    }

    /** general set method, input as string
     *  ie can be set as $staticlink.setStaticLink(&quot;images/imagename&quot;)
     */
    public String setStaticLink(String staticlink)
    {
        //URI Logic
    }

}

</pre></div>
</section>

<section>
<h2><a name="Using_the_Context_Object_with_the_Base.2FPeer_OM"></a>Using the Context Object with the Base/Peer OM</h2>

<p>
As a more complex example, assume we are building a book archive system,
where users can search for books by author and title. If we search on author
&quot;Greg Egan&quot; and title &quot;Permutation City&quot;, we can query the database through the
base\peer system and return a Book Object that contains the information on the
book &quot;Permutation City&quot;. The Book Object would be placed in the context via;
</p>


<div class="source"><pre class="prettyprint">
    Book book = new Book();

    //add the data to the Book Object
    //from the Base/Peer Objects for Book

    context.put(&quot;book&quot;, book);

</pre></div>


<p>
and then accessed in the velocity template by;
</p>


<div class="source"><pre class="prettyprint">
    $book.getAuthor()
    $book.getTitle()
</pre></div>


<p>
where the two methods are public methods in the Book Object, in this case built
by the <a href="torque.html">Torque Tool</a>. These methods would return;
</p>


<div class="source"><pre class="prettyprint">
    Greg Egan
    Permutation City
</pre></div>


<p>
It is important not to try and put Objects with value null into the Context.
A NullPointerException will be returned. This above example is intended to get
across how the Velocity Context can be used to store data from the Base/Peer
system that can be accessed from the Templates.
</p>
</section>



        </main>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>&#169;      2000&#x2013;2021
<a href="https://www.apache.org/">The Apache Software Foundation</a>
</p>
        </div>
      </div>
    </footer>
  </body>
</html>
