<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.11.1 from xdocs/proposals/unified-templating.xml at 24 October 2022
 | Rendered using Apache Maven Fluido Skin 1.9
-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 1.11.1" />
    <title>Apache Turbine &#x2013; Unified Templating Service Proposal</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.9.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />
    <script src="../js/apache-maven-fluido-1.9.min.js"></script>
<link rel="icon" type="image/png" sizes="48x48" href="./images/favicon.ico"> 
      <link rel="icon" type="image/png" sizes="48x48" href="../images/favicon.ico"> 
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
  </head>
  <body class="topBarDisabled">
    <a href="https://github.com/apache/turbine-core">
      <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 10000;"
        src="https://s3.amazonaws.com/github/ribbons/forkme_right_orange_ff7600.png"
        alt="Fork me on GitHub">
    </a>
    <div class="container-fluid">
      <header>
        <div id="banner">
          <div class="pull-left"><a href="../../" id="bannerLeft" title="Apache Turbine"><img src="../images/turbine-project-apache-separate.png"  alt="Apache Turbine"/></a></div>
          <div class="pull-right"><div id="bannerRight"><img src="../images/logo.gif"  alt=""/></div>
</div>
          <div class="clear"><hr/></div>
        </div>

        <div id="breadcrumbs">
          <ul class="breadcrumb">
        <li id="publishDate">Last Published: 24 October 2022<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 5.2-SNAPSHOT</li>
      <li class="pull-right"><span class="divider">|</span>
<a href="https://turbine.apache.org/fulcrum/" class="externalLink" title="Fulcrum">Fulcrum</a></li>
      <li class="pull-right"><span class="divider">|</span>
<a href="https://turbine.apache.org/" class="externalLink" title="Turbine">Turbine</a></li>
      <li class="pull-right"><a href="https://www.apache.org" class="externalLink" title="Apache">Apache</a></li>
          </ul>
        </div>
      </header>
      <div class="row-fluid">
        <header id="leftColumn" class="span2">
          <nav class="well sidebar-nav">
  <ul class="nav nav-list">
   <li class="nav-header">General Information</li>
    <li><a href="../index.html" title="Overview"><span class="none"></span>Overview</a></li>
    <li><a href="../features.html" title="Features"><span class="none"></span>Features</a></li>
    <li><a href="../fsd.html" title="Specification"><span class="none"></span>Specification</a></li>
    <li><a href="../getting-started.html" title="Getting Started"><span class="none"></span>Getting Started</a></li>
    <li><a href="../how-to-build.html" title="Howto Build Turbine"><span class="none"></span>Howto Build Turbine</a></li>
    <li><a href="../changes-report.html" title="Changes"><span class="none"></span>Changes</a></li>
   <li class="nav-header">Documentation</li>
    <li><a href="../services/index.html" title="Services"><span class="icon-chevron-right"></span>Services</a></li>
    <li><a href="../howto/index.html" title="Howtos"><span class="icon-chevron-right"></span>Howtos</a></li>
    <li><a href="https://cwiki.apache.org/confluence/display/TURBINE" class="externalLink" title="Wiki"><span class="none"></span>Wiki</a></li>
    <li><a href="../apidocs/index.html" title="JavaDocs"><span class="none"></span>JavaDocs</a></li>
   <li class="nav-header">Development</li>
    <li><a href="../proposals.html" title="Proposals"><span class="none"></span>Proposals</a></li>
    <li><a href="../how-to-help.html" title="How To Help"><span class="none"></span>How To Help</a></li>
    <li><a href="../todo.html" title="Todo"><span class="none"></span>Todo</a></li>
   <li class="nav-header">Project Documentation</li>
    <li><a href="../project-info.html" title="Project Information"><span class="icon-chevron-right"></span>Project Information</a></li>
    <li><a href="../project-reports.html" title="Project Reports"><span class="icon-chevron-right"></span>Project Reports</a></li>
   <li class="nav-header">Apache</li>
    <li><a href="https://www.apache.org/" class="externalLink" title="Apache Website"><span class="none"></span>Apache Website</a></li>
    <li><a href="https://www.apache.org/licenses/" class="externalLink" title="License"><span class="none"></span>License</a></li>
    <li><a href="https://www.apache.org/foundation/how-it-works.html" class="externalLink" title="How the ASF works"><span class="none"></span>How the ASF works</a></li>
    <li><a href="https://www.apache.org/foundation/sponsorship.html" class="externalLink" title="Sponsorship"><span class="none"></span>Sponsorship</a></li>
    <li><a href="https://www.apache.org/foundation/thanks.html" class="externalLink" title="Thanks"><span class="none"></span>Thanks</a></li>
    <li><a href="https://www.apache.org/security/" class="externalLink" title="Security"><span class="none"></span>Security</a></li>
  </ul>
          </nav>
          <div class="well sidebar-nav">
<form id="search-form" action="https://www.google.com/search" method="get" >
  <input value="http://turbine.apache.org/turbine-core" name="sitesearch" type="hidden"/>
  <input class="search-query" name="q" id="query" type="text" />
</form>
<script>asyncJs( 'https://cse.google.com/brand?form=search-form' )</script>
            <hr />
            <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
<a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="../images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </header>
        <main id="bodyColumn"  class="span10" >


    

<section>
<h2><a name="Unified_Templating_Service"></a>Unified Templating Service</h2>


<p>
There are multiple templating services that provide similar functionality, but 
have different API. This is due to different types of  &quot;Context&quot; objects. All 
these types main&quot;Map&quot; semantics (question: is there any other important 
functionality in the Contexts?). We could define a single service interface 
that all of the templating services (WebMacro, Velocity, FreeMarker and JSP at 
the moment) would implement. Its methods would use Map type to represent a 
Context or another interface extending or similar to map. The service would 
include the following methods:
</p>


<div>
<pre>
public interface TemplatingService 
    extends Service
{
    public boolean templateExists( String name );
    public Map createContext( RunData data );
    public Map createContext( );
    public Strinq merqeTemplate( String name, Map context );
}
</pre></div>


<p>
Definition of this common interface would allow creation of new base Modules 
(Screen, Navigation, Layout and Page) that would take advantage of the 
templating abstraction provided by the Service. This would make the modules 
(esp. Screens) contained in the application independent of the particular 
templating mechanism. 
</p>


<p>
I don't know enough about FreeMarker to tell if it can fit into this model. 
If not, I would even suggest dropping the support for it, as it's user base 
seems nonexistent.
</p>


<p>
There is one important special case to consider. JSP service is unable to return
the results of template merging as a String - they are written to the Response 
stream directly. To encompass this case in our framework, we could declare that 
the return value of merge template in this case is a null. The Modules would be 
subject to the same semantics: a null returned from build() method would mean that 
data was written to the response directly, and the caller should act accordingly. 
(an example of such case is the interaction of the Layout and the RawScreen).
</p>


<p>
The special semantics of JSP templating lead in turn to a special Page and Layout 
module behavior. While the &quot;normal&quot; Layout module executes the Screen module 
and merges its template before merging it's own template (&quot;prefix&quot; rendering), 
the JSP Layout needs to wrap Screen rendering in a context tool so that it is 
executed in the appropriate place in the Layout's markup. (&quot;infix&quot; rendering). 
The same patterns apply to Page-Layout interaction. We have the option to define
JSPPage and JSPLayout Modules, or define InfixPage, InfixLayout and the 
LayoutRenderer and ScreenRenderer context tools, that will be used with those 
templating services that write the merging results directly to the Response 
stream. Note that during the normal Layout processing, the Navigations are 
subject to &quot;infix&quot; rendering, and the current TemplateNavigation class is a 
prototype of *Renderer.
</p>


<p>
The unified interface and the Infix* Modules will make adding support for other
templating engines easy. This will also make porting applications easier - 
templates in one templating language can be created, then supporting Turbine 
modules are created. Later the templates can be converted to another language, 
and the only change to support that on the code side of things is switching a 
property in TR.props
</p>


<p>
The template lookup functionality that is currently contained in 
TemplateService, probably should be contained in the service I'm describing here,
probably in an abstract base class.
</p>


<p>
Another class that would be affected by the changes mentioned here is the 
TempateInfo class. Right now it uses a HashTable to store it's data.
Now, thanks to defining the common Context type (or using the Map type 
in its place), it's possible to turn the runtime typed HashTable entries into
compile time typed instance variables.
</p>


<p>
The amount of work needed to port an existing application should not be very large. 
The applications following the Pull MVC design model would not be affected at all. 
The traditional Push applications would require changes in the Screen and Navigation 
classes regarding the names of the Context type and the parent type of the 
Screen/Navigation in question. These changes can be effectively introduced using an 
automated tool.
</p>


<p>
The Page and Layout classes would require more in-depth modifications, but a typical 
application would contain single customized Page and Layout classes, if any.
</p>

</section>



        </main>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>&#169;      2000&#x2013;2022
<a href="https://www.apache.org/">The Apache Software Foundation</a>
</p>
        </div>
      </div>
    </footer>
  </body>
</html>
