<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html><head><title>Turbine - Unified Templating Service Proposal</title><style type="text/css" media="all">
          @import url("../style/maven-base.css");
          
          @import url("../style/maven-theme.css");</style><link rel="stylesheet" href="../style/print.css" type="text/css" media="print"></link><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"></meta><meta name="author" content="Rafal Krzewski"></meta><meta name="email" content="rafal@apache.org"></meta></head><body class="composite"><div id="banner"><a href="http://turbine.apache.org/" id="organizationLogo"><img alt="Apache Software Foundation" src="../images/turbine-project.png"></img></a><a href="http://turbine.apache.org/turbine/turbine-2.3.3/index.html" id="projectLogo"><img alt="turbine-2" src="../images/logo.gif"></img></a><div class="clear"><hr></hr></div></div><div id="breadcrumbs"><div class="xleft">Last published: 21 November 2008
                <span class="separator">|</span> Doc for  2.3.3
                </div><div class="xright">
        
        <a href="http://turbine.apache.org/">Turbine Home</a>
      
        
          
            <span class="separator">|</span>
          
        
        <a href="http://turbine.apache.org/fulcrum/">Fulcrum</a>
      
        
          
            <span class="separator">|</span>
          
        
        <a href="http://turbine.apache.org/meta/">META</a>
      </div><div class="clear"><hr></hr></div></div><div id="leftColumn"><div id="navcolumn"><div id="menuGeneral_Information"><h5>General Information</h5><ul><li class="none"><a href="../index.html">Overview</a></li><li class="none"><a href="../features.html">Features</a></li><li class="none"><a href="../fsd.html">Specification</a></li><li class="none"><a href="../getting-started.html">Getting Started</a></li></ul></div><div id="menuDocumentation"><h5>Documentation</h5><ul><li class="none"><a href="../changes-report.html">Changes</a></li><li class="none"><a href="../turbine-schema.html">Core DB Schema</a></li><li class="collapsed"><a href="../services/index.html">Services</a></li><li class="collapsed"><a href="../howto/index.html">Howtos</a></li><li class="none"><a href="../apidocs/index.html">JavaDocs</a></li></ul></div><div id="menuDevelopment"><h5>Development</h5><ul><li class="none"><a href="../proposals.html">Proposals</a></li><li class="none"><a href="../how-to-help.html">How To Help</a></li><li class="none"><a href="../todo.html">Todo</a></li></ul></div><div id="menuProject_Documentation"><h5>Project Documentation</h5><ul><li class="none"><a href="../index.html">About</a></li><li class="collapsed"><a href="../project-info.html">Project Info</a></li><li class="collapsed"><a href="../maven-reports.html">Project Reports</a></li><li class="none"><a href="../development-process.html">Development Process</a></li></ul></div><div id="legend"><h5>Legend</h5><ul><li class="externalLink">External Link</li><li class="newWindow">Opens in a new window</li></ul></div><a href="http://maven.apache.org/" title="Built by Maven" id="poweredBy"><img alt="Built by Maven" src="../images/logos/mavenlogo_builtby_w.png"></img></a></div></div><div id="bodyColumn"><div class="contentBox"><div class="section"><a name="Unified_Templating_Service"></a><h2>Unified Templating Service</h2>

<p>
There are multiple templating services that provide similar functionality, but 
have different API. This is due to different types of  "Context" objects. All 
these types main"Map" semantics (question: is there any other important 
functionality in the Contexts?). We could define a single service interface 
that all of the templating services (WebMacro, Velocity, FreeMarker and JSP at 
the moment) would implement. Its methods would use Map type to represent a 
Context or another interface extending or similar to map. The service would 
include the following methods:
</p>

<pre>
public interface TemplatingService 
    extends Service
{
    public boolean templateExists( String name );
    public Map createContext( RunData data );
    public Map createContext( );
    public Strinq merqeTemplate( String name, Map context );
}
</pre>

<p>
Definition of this common interface would allow creation of new base Modules 
(Screen, Navigation, Layout and Page) that would take advantage of the 
templating abstraction provided by the Service. This would make the modules 
(esp. Screens) contained in the application independent of the particular 
templating mechanism. 
</p>

<p>
I don't know enough about FreeMarker to tell if it can fit into this model. 
If not, I would even suggest dropping the support for it, as it's user base 
seems nonexistent.
</p>

<p>
There is one important special case to consider. JSP service is unable to return
the results of template merging as a String - they are written to the Response 
stream directly. To encompass this case in our framework, we could declare that 
the return value of merge template in this case is a null. The Modules would be 
subject to the same semantics: a null returned from build() method would mean that 
data was written to the response directly, and the caller should act accordingly. 
(an example of such case is the interaction of the Layout and the RawScreen).
</p>

<p>
The special semantics of JSP templating lead in turn to a special Page and Layout 
module behavior. While the "normal" Layout module executes the Screen module 
and merges its template before merging it's own template ("prefix" rendering), 
the JSP Layout needs to wrap Screen rendering in a context tool so that it is 
executed in the appropriate place in the Layout's markup. ("infix" rendering). 
The same patterns apply to Page-Layout interaction. We have the option to define
JSPPage and JSPLayout Modules, or define InfixPage, InfixLayout and the 
LayoutRenderer and ScreenRenderer context tools, that will be used with those 
templating services that write the merging results directly to the Response 
stream. Note that during the normal Layout processing, the Navigations are 
subject to "infix" rendering, and the current TemplateNavigation class is a 
prototype of *Renderer.
</p>

<p>
The unified interface and the Infix* Modules will make adding support for other
templating engines easy. This will also make porting applications easier - 
templates in one templating language can be created, then supporting Turbine 
modules are created. Later the templates can be converted to another language, 
and the only change to support that on the code side of things is switching a 
property in TR.props
</p>

<p>
The template lookup functionality that is currently contained in 
TemplateService, probably should be contained in the service I'm describing here,
probably in an abstract base class.
</p>

<p>
Another class that would be affected by the changes mentioned here is the 
TempateInfo class. Right now it uses a HashTable to store it's data.
Now, thanks to defining the common Context type (or using the Map type 
in its place), it's possible to turn the runtime typed HashTable entries into
compile time typed instance variables.
</p>

<p>
The amount of work needed to port an existing application should not be very large. 
The applications following the Pull MVC design model would not be affected at all. 
The traditional Push applications would require changes in the Screen and Navigation 
classes regarding the names of the Context type and the parent type of the 
Screen/Navigation in question. These changes can be effectively introduced using an 
automated tool.
</p>

<p>
The Page and Layout classes would require more in-depth modifications, but a typical 
application would contain single customized Page and Layout classes, if any.
</p>

</div></div></div><div class="clear"><hr></hr></div><div id="footer"><div class="xright">© 2000-2008, Apache Software Foundation</div><div class="clear"><hr></hr></div></div></body></html>